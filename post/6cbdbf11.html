<!DOCTYPE html><html lang="zh-CN" data-theme="dark"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0"><title>C#上位机学习 | Luckys-Yangの小栈</title><meta name="author" content="Luckys-Yang"><meta name="copyright" content="Luckys-Yang"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#0d0d0d"><meta name="description" content="前言 参考文章&#x2F;博主  &#x2F; 软件  VS2012安装包-提取码：AK47 我的仓库  GITHUB-C- 软件安装  右键管理员身份双击 Visual Studio 2012            [{&quot;url&quot;:&quot;https:&#x2F;&#x2F;image-1309791158.cos.ap-guangzhou.myqcloud.com&#x2F;其他&#x2F;QQ截图20230522144833.webp&quot;,&quot;alt&quot;:&quot;&quot;}">
<meta property="og:type" content="article">
<meta property="og:title" content="C#上位机学习">
<meta property="og:url" content="https://mdcm.yang5201314.cn/post/6cbdbf11.html">
<meta property="og:site_name" content="Luckys-Yangの小栈">
<meta property="og:description" content="前言 参考文章&#x2F;博主  &#x2F; 软件  VS2012安装包-提取码：AK47 我的仓库  GITHUB-C- 软件安装  右键管理员身份双击 Visual Studio 2012            [{&quot;url&quot;:&quot;https:&#x2F;&#x2F;image-1309791158.cos.ap-guangzhou.myqcloud.com&#x2F;其他&#x2F;QQ截图20230522144833.webp&quot;,&quot;alt&quot;:&quot;&quot;}">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://mdcm.yang5201314.cn/img/num132.webp">
<meta property="article:published_time" content="2023-05-22T06:39:06.000Z">
<meta property="article:modified_time" content="2023-06-03T05:53:30.776Z">
<meta property="article:author" content="Luckys-Yang">
<meta property="article:tag" content="牛逼">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://mdcm.yang5201314.cn/img/num132.webp"><link rel="shortcut icon" href="https://image-1309791158.cos.ap-guangzhou.myqcloud.com/butterfly/blog_other/93801118587.webp"><link rel="canonical" href="https://mdcm.yang5201314.cn/post/6cbdbf11.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="/" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.staticfile.org/fancyapps-ui/4.0.31/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: {"appId":"MSZRRKNRKT","apiKey":"71e2a5ac35435ee76602cd55d727e5ff","indexName":"aaa","hits":{"per_page":10},"languages":{"input_placeholder":"搜索文章","hits_empty":"找不到您查询的内容：${query}","hits_stats":"找到 ${hits} 条结果，用时 ${time} 毫秒"}},
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  highlight: {"plugin":"prismjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":300},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.staticfile.org/flickr-justified-gallery/2.1.2/fjGallery.min.js',
      css: 'https://cdn.staticfile.org/flickr-justified-gallery/2.1.2/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  }
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'C#上位机学习',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-06-03 13:53:30'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = url => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      link.onload = () => resolve()
      link.onerror = () => reject()
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="/css/rightmenu.css" media="all" onload="this.media='all'"><link rel="preconnect" href="https://s1.hdslb.com/" /><link rel="stylesheet" href="//s1.hdslb.com/bfs/static/jinkela/long/font/regular.css" media="all" onload="this.media='all'" /><link rel="stylesheet" href="//s1.hdslb.com/bfs/static/jinkela/long/font/medium.css" media="all" onload="this.media='all'" /><link rel="shortcut icon" href="#"><link href="https://image-1309791158.cos.ap-guangzhou.myqcloud.com/butterfly/css/all.min.css" rel="stylesheet"><link rel="stylesheet" href="/css/my.css" media="all" onload="this.media='all'"><link rel="stylesheet" href="/css/universe.css" ><link rel="stylesheet" href="https://jsd.onmicrosoft.cn/npm/izitoast@1.4.0/dist/css/iziToast.min.css" media="all" onload="this.media='all'"><link rel="stylesheet" href="/css/aplayer.css" media="all" onload="this.media='all'"><!-- hexo injector head_end start --><link rel="stylesheet" href="https://jsd.onmicrosoft.cn/gh/Zfour/Butterfly-double-row-display@1.00/cardlistpost.min.css"/>
<style>#recent-posts > .recent-post-item >.recent-post-info > .article-meta-wrap > .tags:before {content:"\A";
  white-space: pre;}#recent-posts > .recent-post-item >.recent-post-info > .article-meta-wrap > .tags > .article-meta__separator{display:none}</style>
<link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-wowjs/lib/animate.min.css" media="print" onload="this.media='screen'"><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.3.0"></head><body><div id="loading-box"><style>css-doodle {--color: @p(#51eaea, #fffde1, #ff9d76, #FB3569);--rule: (:doodle {@grid: 30x1 / 18vmin;--deg: @p(-180deg, 180deg);}:container {perspective: 30vmin;}:after, :before {content: '';background: var(--color); @place-cell: @r(100%) @r(100%); @size: @r(6px); @shape: heart;} @place-cell: center; @size: 100%;box-shadow: @m2(0 0 50px var(--color));background: @m100(radial-gradient(var(--color) 50%, transparent 0)@r(-20%, 120%) @r(-20%, 100%) / 1px 1px no-repeat); will-change: transform, opacity; animation: scale-up 12s linear infinite; animation-delay: calc(-12s / @I * @i); @keyframes scale-up { 0%, 95.01%, 100% {transform: translateZ(0) rotate(0);opacity: 0;}10% {opacity: 1;}95% {transform: translateZ(35vmin) rotateZ(@var(--deg));}})}</style><css-doodle use="var(--rule)"></css-doodle><script async="async" src="https://cdn.bootcdn.net/ajax/libs/css-doodle/0.32.2/css-doodle.min.js"></script></div><script>const preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',()=> { preloader.endLoading() })

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://image-1309791158.cos.ap-guangzhou.myqcloud.com/butterfly/blog_other/93801118587.webp" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">136</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">76</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">31</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 目录</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-list-alt"></i><span> 归档</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/bookmarking/"><i class="fa-fw fas fa-star"></i><span> 收藏</span></a></div><div class="menus_item"><a class="site-page" href="/comments/"><i class="fa-fw fas fa-comment"></i><span> 留言</span></a></div><div class="menus_item"><a class="site-page" href="/shuoshuo/"><i class="fa-fw fas fa-pen"></i><span> 说说</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-info-circle"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="not-top-img" id="page-header"><nav class="fixed" id="nav"><span id="blog-info"><a href="/" title="Luckys-Yangの小栈"><img class="site-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://image-1309791158.cos.ap-guangzhou.myqcloud.com/%E5%85%B6%E4%BB%96/light.png"/></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 目录</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-list-alt"></i><span> 归档</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/bookmarking/"><i class="fa-fw fas fa-star"></i><span> 收藏</span></a></div><div class="menus_item"><a class="site-page" href="/comments/"><i class="fa-fw fas fa-comment"></i><span> 留言</span></a></div><div class="menus_item"><a class="site-page" href="/shuoshuo/"><i class="fa-fw fas fa-pen"></i><span> 说说</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-info-circle"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav></header><main class="layout" id="content-inner"><div id="post"><div id="post-info"><h1 class="post-title">C#上位机学习</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-05-22T06:39:06.000Z" title="发表于 2023-05-22 14:39:06">2023-05-22</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-06-03T05:53:30.776Z" title="更新于 2023-06-03 13:53:30">2023-06-03</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E7%BB%86%E5%8C%96%E5%AD%A6%E4%B9%A0/">细化学习</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">11.7k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>61分钟</span></span></div></div></div><article class="post-content" id="article-container"><h2 id="前言">前言</h2>
<div class="note blue icon-padding flat"><i class="note-icon fas fa-fan"></i><p>参考文章/博主</p>
</div>
<p>/</p>
<div class="note blue icon-padding flat"><i class="note-icon fas fa-fan"></i><p>软件</p>
</div>
<p><a href="https://pan.baidu.com/s/1F4mbhuLjXSmJMVTUopsnmw?pwd=AK47">VS2012安装包-提取码：AK47</a></p>
<div class="note blue icon-padding flat"><i class="note-icon fas fa-fan"></i><p>我的仓库</p>
</div>
<p><a href="https://github.com/luckys-yang/C-">GITHUB-C-</a></p>
<h2 id="软件安装">软件安装</h2>
<ul>
<li>右键管理员身份双击 <code>Visual Studio 2012</code></li>
</ul>
<div class="gallery">
    <div class="fj-gallery " data-rowHeight="220" data-limit="10">
    <span class="gallery-data">[{"url":"https://image-1309791158.cos.ap-guangzhou.myqcloud.com/其他/QQ截图20230522144833.webp","alt":""},{"url":"https://image-1309791158.cos.ap-guangzhou.myqcloud.com/其他/QQ截图20230522144859.webp","alt":""}]</span>
    </div>
    <button class="gallery-load-more"><span>加载更多</span><i class="fa-solid fa-arrow-down"></i></button>
    </div>
<ul>
<li>安装完成后启动，填写PJ码即可</li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">YKCW6-BPFPF-BT8C9-7DCTH-QXGWC</code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://image-1309791158.cos.ap-guangzhou.myqcloud.com/%E5%85%B6%E4%BB%96/QQ%E6%88%AA%E5%9B%BE20230522152922.webp" alt=""></p>
<ul>
<li>选择C#</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://image-1309791158.cos.ap-guangzhou.myqcloud.com/%E5%85%B6%E4%BB%96/QQ%E6%88%AA%E5%9B%BE20230522153009.webp" alt=""></p>
<ul>
<li>新建项目，建议选择 <code>.NET Framework 4版本</code> ， 如果选择4.5或更高的版本，设计的上位机应用程序将不能在XP系统电脑上运行。</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://image-1309791158.cos.ap-guangzhou.myqcloud.com/%E5%85%B6%E4%BB%96/QQ%E6%88%AA%E5%9B%BE20230522153833.webp" alt=""></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://image-1309791158.cos.ap-guangzhou.myqcloud.com/%E5%85%B6%E4%BB%96/QQ%E6%88%AA%E5%9B%BE20230522154013.webp" alt=""></p>
<h2 id="工程管理器">工程管理器</h2>
<ul>
<li>修改生成的EXE图标</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://image-1309791158.cos.ap-guangzhou.myqcloud.com/%E5%85%B6%E4%BB%96/QQ%E6%88%AA%E5%9B%BE20230530190117.webp" alt=""></p>
<p>![](<a href="https://image-1309791158.cos.ap-guangzhou.myqcloud.com/%E5%85%B6%E4%BB%96/QQ%E6%88%AA%E5%9B%BE20230530190154">https://image-1309791158.cos.ap-guangzhou.myqcloud.com/其他/QQ截图20230530190154</a> (1).webp)</p>
<ul>
<li>【AssemblyInfo.cs】</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://image-1309791158.cos.ap-guangzhou.myqcloud.com/%E5%85%B6%E4%BB%96/QQ%E6%88%AA%E5%9B%BE20230530190600.webp" alt=""></p>
<ul>
<li>【Program.cs】</li>
</ul>
<p>程序的入口，相当于C语言的Main函数</p>
<ul>
<li>【Form1.cs】【常用】</li>
</ul>
<p>窗体</p>
<p>里面的 <code>Form1</code> 是后台，写代码的地方【常用】</p>
<p>里面的 <code>Form1.Designer.cs</code> 是控件地方，添加一个控件里面自动会添加对应的代码</p>
<ul>
<li>工具栏</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://image-1309791158.cos.ap-guangzhou.myqcloud.com/%E5%85%B6%E4%BB%96/QQ%E6%88%AA%E5%9B%BE20230530204328.webp" alt=""></p>
<ul>
<li>控件事件</li>
</ul>
<p>双击事件名称或者双击窗体控件就会生成并跳转到事件</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://image-1309791158.cos.ap-guangzhou.myqcloud.com/%E5%85%B6%E4%BB%96/QQ%E6%88%AA%E5%9B%BE20230530210131.webp" alt=""></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://image-1309791158.cos.ap-guangzhou.myqcloud.com/%E5%85%B6%E4%BB%96/QQ%E6%88%AA%E5%9B%BE20230530210828.webp" alt=""></p>
<h2 id="第2讲">第2讲</h2>
<ul>
<li>窗体控件属性</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://image-1309791158.cos.ap-guangzhou.myqcloud.com/%E5%85%B6%E4%BB%96/3423dfgdf.webp" alt=""></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://image-1309791158.cos.ap-guangzhou.myqcloud.com/%E5%85%B6%E4%BB%96/QQ%E5%9B%BE%E7%89%8720230530220317.webp" alt=""></p>
<ul>
<li><code>Button 按钮</code> 和 <code>TextBox 文本框</code></li>
</ul>
<blockquote>
<p>换行可以 <code>\r\n</code></p>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://image-1309791158.cos.ap-guangzhou.myqcloud.com/%E5%85%B6%E4%BB%96/QQ%E6%88%AA%E5%9B%BE20230530234859.webp" alt=""></p>
<ul>
<li><code>ComboBox 组合框</code> 和 <code>Lable 标签</code></li>
</ul>
<blockquote>
<p>组合框 <code>DropDownStyle</code> 属性 可以设置为 <code>DropDownList</code>，这样别人就不能修改内容了只能选</p>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://image-1309791158.cos.ap-guangzhou.myqcloud.com/%E5%85%B6%E4%BB%96/QQ%E6%88%AA%E5%9B%BE20230531071139.webp" alt=""></p>
<ul>
<li><code>checkBox 多选框</code> 和 <code>RadioButton 单选框</code> ----- 容器： <code>Panel 面板</code></li>
</ul>
<blockquote>
<p><code>Checked</code> 属性可以用来判断多选框是否被选中状态</p>
<p>单选框的话只能有一个处于被选中状态，然后如果需要把单选框分开，互不影响则用到容器—面板</p>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://image-1309791158.cos.ap-guangzhou.myqcloud.com/%E5%85%B6%E4%BB%96/QQ%E6%88%AA%E5%9B%BE20230531073911.webp" alt=""></p>
<ul>
<li><code>ProgressBar 进度条</code> 和 <code>PictrueBox 图片框</code></li>
</ul>
<blockquote>
<p>添加图片的话去资源那添加，需要把图片先复制到工程下文件夹里</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://image-1309791158.cos.ap-guangzhou.myqcloud.com/%E5%85%B6%E4%BB%96/QQ%E6%88%AA%E5%9B%BE20230531080326.webp" alt=""></p>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://image-1309791158.cos.ap-guangzhou.myqcloud.com/%E5%85%B6%E4%BB%96/QQ%E6%88%AA%E5%9B%BE20230531085827.webp" alt=""></p>
<ul>
<li><code>GroupBox 组合框</code>，—组件：<code>SerialPort 串口</code> <code>Timer 定时器</code></li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://image-1309791158.cos.ap-guangzhou.myqcloud.com/%E5%85%B6%E4%BB%96/QQ%E6%88%AA%E5%9B%BE20230531091938.webp" alt=""></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://image-1309791158.cos.ap-guangzhou.myqcloud.com/%E5%85%B6%E4%BB%96/QQ%E6%88%AA%E5%9B%BE20230531091820.webp" alt=""></p>
<ul>
<li>图形化按钮设计</li>
</ul>
<blockquote>
<p>按下变成另一张图片</p>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://image-1309791158.cos.ap-guangzhou.myqcloud.com/%E5%85%B6%E4%BB%96/QQ%E6%88%AA%E5%9B%BE20230531093541.webp" alt=""></p>
<h2 id="第3讲">第3讲</h2>
<ul>
<li>定时器窗体界面设计</li>
</ul>
<details ><summary> Form1.cs </summary>
              <div class='content'>
              <pre class="line-numbers language-c#" data-language="c#"><code class="language-c#">using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Data;
using System.Drawing;
using System.Linq;
using System.Text;
using System.Windows.Forms;

namespace TEST1
&#123;
    public partial class My_EXE : Form
    &#123;
        &#x2F;&#x2F; 总定时时间
        UInt16 TimerValue &#x3D; 0;
        &#x2F;&#x2F; 定时器计数
        UInt16 Timer1_Cnt &#x3D; 0;
        &#x2F;&#x2F; 定时状态---0：停止定时 1：开始定时 2：暂停定时
        byte Timing_State &#x3D; 0;

        public My_EXE()
        &#123;
            InitializeComponent();
        &#125;

        private void flowLayoutPanel1_Paint(object sender, PaintEventArgs e)
        &#123;

        &#125;

        private void 串口助手_LUCKY_Load(object sender, EventArgs e)
        &#123;
            byte i &#x3D; 0;
            for (i &#x3D; 0; i &lt; 60; i++)
            &#123;
                comboBox1.Items.Add(i.ToString());
                comboBox2.Items.Add(i.ToString());
            &#125;
            comboBox1.Text &#x3D; &quot;0&quot;;
            comboBox2.Text &#x3D; &quot;0&quot;;
        &#125;

        private void comboBox1_SelectedIndexChanged(object sender, EventArgs e)
        &#123;

        &#125;

        private void button1_Click(object sender, EventArgs e)
        &#123;
            switch (Timing_State)
            &#123;
                case 0:
                    &#123;
                        &#x2F;&#x2F; 获取总的时间
                        TimerValue &#x3D; Convert.ToUInt16(comboBox1.Text);
                        TimerValue *&#x3D; 60;
                        TimerValue +&#x3D; Convert.ToUInt16(comboBox2.Text);
                        if (TimerValue &gt; 0)
                        &#123;
                            textBox1.Text &#x3D; TimerValue.ToString();
                            &#x2F;&#x2F; 框字体颜色
                            button1.ForeColor &#x3D; Color.Green;
                            button1.Text &#x3D; &quot;暂停计时&quot;;
                            &#x2F;&#x2F; 使能BUTTON2
                            button2.Enabled &#x3D; true;
                            &#x2F;&#x2F; 失能定时时间设置
                            comboBox1.Enabled &#x3D; false;
                            comboBox2.Enabled &#x3D; false;
                            Timing_State &#x3D; 1;
                            progressBar1.Value &#x3D; 0;
                            progressBar1.Maximum &#x3D; TimerValue;
                            timer1.Start();
                        &#125;
                        else
                        &#123;
                            &#x2F;&#x2F; 提示音
                            System.Media.SystemSounds.Beep.Play();
                            &#x2F;&#x2F; 提示框
                            MessageBox.Show(&quot;定时时间不能为0!&quot;, &quot;警告&quot;);
                        &#125;
                        break;
                    &#125;
                case 1:
                    &#123;
                        timer1.Stop();
                        &#x2F;&#x2F; 框字体颜色
                        button1.ForeColor &#x3D; Color.Green;
                        button1.Text &#x3D; &quot;计时继续&quot;;
                        Timing_State &#x3D; 2;
                        break;
                    &#125;
                case 2:
                    &#123;
                        timer1.Start();
                        &#x2F;&#x2F; 框字体颜色
                        button1.ForeColor &#x3D; Color.Green;
                        button1.Text &#x3D; &quot;暂停计时&quot;;
                        Timing_State &#x3D; 0;
                        break;
                    &#125;
                default: break;
            &#125;
        &#125;

        private void timer1_Tick(object sender, EventArgs e)
        &#123;
            Timer1_Cnt++;
            textBox1.Text &#x3D; (TimerValue - Timer1_Cnt).ToString();
            progressBar1.Value &#x3D; Timer1_Cnt;
            if (Timer1_Cnt &#x3D;&#x3D; TimerValue)
            &#123;
                timer1.Stop();
                Timer1_Cnt &#x3D; 0;
                &#x2F;&#x2F; 框字体颜色
                button1.ForeColor &#x3D; Color.Black;
                button1.Text &#x3D; &quot;计时结束&quot;;
                &#x2F;&#x2F; 提示音
                System.Media.SystemSounds.Beep.Play();
                &#x2F;&#x2F; 提示框
                MessageBox.Show(&quot;时间到了&quot;, &quot;提示&quot;);
                button1.Text &#x3D; &quot;开始定时&quot;;
                textBox1.Text &#x3D; &quot; &quot;;
                comboBox1.Text &#x3D; &quot;0&quot;;
                comboBox2.Text &#x3D; &quot;0&quot;;
                comboBox1.Enabled &#x3D; true;
                comboBox2.Enabled &#x3D; true;
                button2.Enabled &#x3D; false;
                progressBar1.Value &#x3D; 0;
                Timing_State &#x3D; 0;
            &#125;
        &#125;

        private void button2_Click(object sender, EventArgs e)
        &#123;
            timer1.Stop();
            Timer1_Cnt &#x3D; 0;
            button1.Text &#x3D; &quot;停止计时&quot;;
            &#x2F;&#x2F; 提示音
            System.Media.SystemSounds.Beep.Play();
            &#x2F;&#x2F; 框字体颜色
            button1.ForeColor &#x3D; Color.Black;
            &#x2F;&#x2F; 提示框
            MessageBox.Show(&quot;停止计时&quot;, &quot;提示&quot;);
            button1.Text &#x3D; &quot;开始定时&quot;;
            textBox1.Text &#x3D; &quot; &quot;;
            comboBox1.Text &#x3D; &quot;0&quot;;
            comboBox2.Text &#x3D; &quot;0&quot;;
            comboBox1.Enabled &#x3D; true;
            comboBox2.Enabled &#x3D; true;
            button2.Enabled &#x3D; false;
            progressBar1.Value &#x3D; 0;
            Timing_State &#x3D; 0;
        &#125;
    &#125;
&#125;
</code></pre>
              </div>
            </details>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://image-1309791158.cos.ap-guangzhou.myqcloud.com/%E5%85%B6%E4%BB%96/QQ%E6%88%AA%E5%9B%BE20230531142852.webp" alt=""></p>
<h2 id="第4讲">第4讲</h2>
<ul>
<li>扫描串口端口号，初始上位机模板设计</li>
</ul>
<details ><summary> Form1.cs </summary>
              <div class='content'>
              <pre class="line-numbers language-c#" data-language="c#"><code class="language-c#">using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Data;
using System.Drawing;
using System.Linq;
using System.Text;
using System.Windows.Forms;

&#x2F;&#x2F; 添加指令集
using System.IO.Ports;


namespace TEST1
&#123;
    public partial class My_EXE : Form
    &#123;
        public My_EXE()
        &#123;
            InitializeComponent();
        &#125;
        private void flowLayoutPanel1_Paint(object sender, PaintEventArgs e)
        &#123;

        &#125;
        &#x2F;&#x2F;打开软件加载
        private void My_EXE_Load(object sender, EventArgs e)
        &#123;
            SearchAndAddSerialToComboBox(serialPort1, comboBox1);
        &#125;
        &#x2F;&#x2F; 手动扫描并添加可用串口
        private void SearchAndAddSerialToComboBox(SerialPort MyPort, ComboBox MyBox)
        &#123;
            &#x2F;&#x2F;清空下拉框
            MyBox.Items.Clear();
            MyBox.Text &#x3D; &quot;&quot;;
            &#x2F;&#x2F; 获取本机串口列表
            string[] ComputerPortName &#x3D; SerialPort.GetPortNames();

            for (byte i &#x3D; 0; i &lt; ComputerPortName.Length; i++)
            &#123;
                try
                &#123;
                    MyPort.PortName &#x3D; ComputerPortName[i];
                    MyPort.Open();
                    MyBox.Items.Add(MyPort.PortName);
                    MyPort.Close();

                    if (MyBox.Text &#x3D;&#x3D; &quot;&quot;)
                    &#123;
                        MyBox.Text &#x3D; MyPort.PortName;
                    &#125;
                &#125;
                catch
                &#123;
 
                &#125;
            &#125;
            if (MyBox.Text &#x3D;&#x3D; &quot;&quot;)
            &#123;
                textBox1.AppendText(&quot;[&quot; + DateTime.Now.ToString(&quot;HH:mm:ss&quot;) + &quot;]&quot; + &quot;-&gt;&quot;);
                textBox1.AppendText(&quot;没有检测到串口工具!\r\n&quot;);
            &#125;
        &#125;
         &#x2F;&#x2F;【手动扫描】
        private void button1_Click(object sender, EventArgs e)
        &#123;
                &#x2F;&#x2F; 先判断串口是否打开，打开了则要关闭再扫描
            if (serialPort1.IsOpen &#x3D;&#x3D; true)
            &#123;
                serialPort1.Close();
                button2.BackgroundImage &#x3D; Properties.Resources.b1;
                button2.Tag &#x3D; &quot;OFF&quot;;
                textBox1.AppendText(&quot;[&quot; + DateTime.Now.ToString(&quot;HH:mm:ss&quot;) + &quot;]&quot; + &quot;-&gt;&quot;);
                textBox1.AppendText(&quot;扫描并添加串口时关闭串口!\r\n&quot;);
            &#125;
            SearchAndAddSerialToComboBox(serialPort1, comboBox1);
        &#125;

        private void button2_Click(object sender, EventArgs e)
        &#123;
            if (button2.Tag.ToString() &#x3D;&#x3D; &quot;OFF&quot;)
            &#123;
                &#x2F;&#x2F; 打开串口
                try
                &#123;
                    serialPort1.PortName &#x3D; comboBox1.Text;
                    serialPort1.Open();
                    button2.BackgroundImage &#x3D; Properties.Resources.b2;
                    button2.Tag &#x3D; &quot;ON&quot;;
                    textBox1.AppendText(&quot;[&quot; + DateTime.Now.ToString(&quot;HH:mm:ss&quot;) + &quot;]&quot; + &quot;-&gt;&quot;);
                    textBox1.AppendText(&quot;手动打开串口!\r\n&quot;);
                &#125;
                catch
                &#123;
                    serialPort1.Close();
                    button2.BackgroundImage &#x3D; Properties.Resources.b1;
                    button2.Tag &#x3D; &quot;OFF&quot;;
                    textBox1.AppendText(&quot;[&quot; + DateTime.Now.ToString(&quot;HH:mm:ss&quot;) + &quot;]&quot; + &quot;-&gt;&quot;);
                    textBox1.AppendText(&quot;串口打开失败!\r\n&quot;);
                &#125;
            &#125;
            else
            &#123;
                &#x2F;&#x2F; 关闭串口
                serialPort1.Close();
                button2.BackgroundImage &#x3D; Properties.Resources.b1;
                button2.Tag &#x3D; &quot;OFF&quot;;
                textBox1.AppendText(&quot;[&quot; + DateTime.Now.ToString(&quot;HH:mm:ss&quot;) + &quot;]&quot; + &quot;-&gt;&quot;);
                textBox1.AppendText(&quot;手动关闭串口!\r\n&quot;);
            &#125;
        &#125;
        &#x2F;&#x2F;【下拉框发生变化】
        private void comboBox1_SelectedIndexChanged(object sender, EventArgs e)
        &#123;
            if (serialPort1.IsOpen &#x3D;&#x3D; true)
            &#123;
                serialPort1.Close();
                try
                &#123;
                    serialPort1.PortName &#x3D; comboBox1.Text;
                    serialPort1.Open();
                    button2.BackgroundImage &#x3D; Properties.Resources.b2;
                    button2.Tag &#x3D; &quot;ON&quot;;
                    textBox1.AppendText(&quot;[&quot; + DateTime.Now.ToString(&quot;HH:mm:ss&quot;) + &quot;]&quot; + &quot;-&gt;&quot;);
                    textBox1.AppendText(&quot;串口更换成功!\r\n&quot;);
                &#125;
                catch
                &#123;
                    serialPort1.Close();
                    button2.BackgroundImage &#x3D; Properties.Resources.b1;
                    button2.Tag &#x3D; &quot;OFF&quot;;
                    textBox1.AppendText(&quot;[&quot; + DateTime.Now.ToString(&quot;HH:mm:ss&quot;) + &quot;]&quot; + &quot;-&gt;&quot;);
                    textBox1.AppendText(&quot;串口更换失败!\r\n&quot;);
                &#125;
            &#125;
        &#125;
        &#x2F;&#x2F;【定时器扫描】
        private void timer1_Tick(object sender, EventArgs e)
        &#123;
                if (!serialPort1.IsOpen)
                &#123;
                    serialPort1.Close();
                    button2.BackgroundImage &#x3D; Properties.Resources.b1;
                    button2.Tag &#x3D; &quot;OFF&quot;;
                    &#x2F;&#x2F; 重新扫描并添加串口
                    SearchAndAddSerialToComboBox(serialPort1, comboBox1);
                &#125;
        &#125;
    &#125;
&#125;
</code></pre>
              </div>
            </details>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://image-1309791158.cos.ap-guangzhou.myqcloud.com/%E5%85%B6%E4%BB%96/QQ%E6%88%AA%E5%9B%BE20230601083626.webp" alt=""></p>
<h2 id="第5讲">第5讲</h2>
<ul>
<li>串口接收和发送数据</li>
</ul>
<blockquote>
<p>使用虚拟串口 <code>VSPD</code> 模拟发送接收</p>
</blockquote>
<details ><summary> Form1.cs </summary>
              <div class='content'>
              <pre class="line-numbers language-c#" data-language="c#"><code class="language-c#">using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Data;
using System.Drawing;
using System.Linq;
using System.Text;
using System.Windows.Forms;

&#x2F;&#x2F; 添加指令集
using System.IO.Ports;


namespace TEST1
&#123;
    public partial class My_EXE : Form
    &#123;
        public My_EXE()
        &#123;
            InitializeComponent();
            &#x2F;&#x2F; 禁止这种异常的抛出(不加的话运行会报错)，避免出现跨线程访问控件
            System.Windows.Forms.Control.CheckForIllegalCrossThreadCalls &#x3D; false;
        &#125;
        private void flowLayoutPanel1_Paint(object sender, PaintEventArgs e)
        &#123;

        &#125;
        &#x2F;&#x2F;打开软件加载
        private void My_EXE_Load(object sender, EventArgs e)
        &#123;
            SearchAndAddSerialToComboBox(serialPort1, comboBox1);
        &#125;
        &#x2F;&#x2F; 手动扫描并添加可用串口
        private void SearchAndAddSerialToComboBox(SerialPort MyPort, ComboBox MyBox)
        &#123;
            &#x2F;&#x2F;清空下拉框
            MyBox.Items.Clear();
            MyBox.Text &#x3D; &quot;&quot;;
            &#x2F;&#x2F; 获取本机串口列表
            string[] ComputerPortName &#x3D; SerialPort.GetPortNames();

            for (byte i &#x3D; 0; i &lt; ComputerPortName.Length; i++)
            &#123;
                try
                &#123;
                    MyPort.PortName &#x3D; ComputerPortName[i];
                    MyPort.Open();
                    MyBox.Items.Add(MyPort.PortName);
                    MyPort.Close();

                    if (MyBox.Text &#x3D;&#x3D; &quot;&quot;)
                    &#123;
                        MyBox.Text &#x3D; MyPort.PortName;
                    &#125;
                &#125;
                catch
                &#123;

                &#125;
            &#125;
            if (MyBox.Text &#x3D;&#x3D; &quot;&quot;)
            &#123;
                textBox1.AppendText(&quot;[&quot; + DateTime.Now.ToString(&quot;HH:mm:ss&quot;) + &quot;]&quot; + &quot;-&gt;&quot;);
                textBox1.AppendText(&quot;没有检测到串口工具!\r\n&quot;);
            &#125;
        &#125;
        &#x2F;&#x2F;【手动扫描】
        private void button1_Click(object sender, EventArgs e)
        &#123;
            &#x2F;&#x2F; 先判断串口是否打开，打开了则要关闭再扫描
            if (serialPort1.IsOpen &#x3D;&#x3D; true)
            &#123;
                serialPort1.Close();
                button2.BackgroundImage &#x3D; Properties.Resources.b1;
                button2.Tag &#x3D; &quot;OFF&quot;;
                textBox1.AppendText(&quot;[&quot; + DateTime.Now.ToString(&quot;HH:mm:ss&quot;) + &quot;]&quot; + &quot;-&gt;&quot;);
                textBox1.AppendText(&quot;扫描并添加串口时关闭串口!\r\n&quot;);
            &#125;
            SearchAndAddSerialToComboBox(serialPort1, comboBox1);
        &#125;

        private void button2_Click(object sender, EventArgs e)
        &#123;
            if (button2.Tag.ToString() &#x3D;&#x3D; &quot;OFF&quot;)
            &#123;
                &#x2F;&#x2F; 打开串口
                try
                &#123;
                    serialPort1.PortName &#x3D; comboBox1.Text;
                    &#x2F;&#x2F; 把字符串波特率转换为32位波特率
                    serialPort1.BaudRate &#x3D; Convert.ToInt32(comboBox2.Text);
                    serialPort1.Open();
                    button2.BackgroundImage &#x3D; Properties.Resources.b2;
                    button2.Tag &#x3D; &quot;ON&quot;;
                    textBox1.AppendText(&quot;[&quot; + DateTime.Now.ToString(&quot;HH:mm:ss&quot;) + &quot;]&quot; + &quot;-&gt;&quot;);
                    textBox1.AppendText(&quot;手动打开串口!\r\n&quot;);
                &#125;
                catch
                &#123;
                    serialPort1.Close();
                    button2.BackgroundImage &#x3D; Properties.Resources.b1;
                    button2.Tag &#x3D; &quot;OFF&quot;;
                    textBox1.AppendText(&quot;[&quot; + DateTime.Now.ToString(&quot;HH:mm:ss&quot;) + &quot;]&quot; + &quot;-&gt;&quot;);
                    textBox1.AppendText(&quot;串口打开失败!\r\n&quot;);
                &#125;
            &#125;
            else
            &#123;
                &#x2F;&#x2F; 关闭串口
                serialPort1.Close();
                button2.BackgroundImage &#x3D; Properties.Resources.b1;
                button2.Tag &#x3D; &quot;OFF&quot;;
                textBox1.AppendText(&quot;[&quot; + DateTime.Now.ToString(&quot;HH:mm:ss&quot;) + &quot;]&quot; + &quot;-&gt;&quot;);
                textBox1.AppendText(&quot;手动关闭串口!\r\n&quot;);
            &#125;
        &#125;
        &#x2F;&#x2F;【下拉框发生变化】
        private void comboBox1_SelectedIndexChanged(object sender, EventArgs e)
        &#123;
            if (serialPort1.IsOpen &#x3D;&#x3D; true)
            &#123;
                serialPort1.Close();
                try
                &#123;
                    serialPort1.PortName &#x3D; comboBox1.Text;
                    serialPort1.Open();
                    button2.BackgroundImage &#x3D; Properties.Resources.b2;
                    button2.Tag &#x3D; &quot;ON&quot;;
                    textBox1.AppendText(&quot;[&quot; + DateTime.Now.ToString(&quot;HH:mm:ss&quot;) + &quot;]&quot; + &quot;-&gt;&quot;);
                    textBox1.AppendText(&quot;串口更换成功!\r\n&quot;);
                &#125;
                catch
                &#123;
                    serialPort1.Close();
                    button2.BackgroundImage &#x3D; Properties.Resources.b1;
                    button2.Tag &#x3D; &quot;OFF&quot;;
                    textBox1.AppendText(&quot;[&quot; + DateTime.Now.ToString(&quot;HH:mm:ss&quot;) + &quot;]&quot; + &quot;-&gt;&quot;);
                    textBox1.AppendText(&quot;串口更换失败!\r\n&quot;);
                &#125;
            &#125;
        &#125;
        &#x2F;&#x2F;【定时器扫描】
        private void timer1_Tick(object sender, EventArgs e)
        &#123;
            if (!serialPort1.IsOpen)
            &#123;
                serialPort1.Close();
                button2.BackgroundImage &#x3D; Properties.Resources.b1;
                button2.Tag &#x3D; &quot;OFF&quot;;
                &#x2F;&#x2F; 重新扫描并添加串口
                SearchAndAddSerialToComboBox(serialPort1, comboBox1);
            &#125;
        &#125;
        &#x2F;&#x2F; 串口接收
        private void serialPort1_DataReceived(object sender, SerialDataReceivedEventArgs e)
        &#123;
            &#x2F;&#x2F; 接格式为ASCII
            if (!checkBox1.Checked)
            &#123;
                try
                &#123;
                    textBox1.AppendText(&quot;[&quot; + DateTime.Now.ToString(&quot;HH:mm:ss&quot;) + &quot;]&quot; + &quot;-&gt;&quot;);
                    string str &#x3D; serialPort1.ReadExisting();    &#x2F;&#x2F; 以字符串格式读
                    textBox1.AppendText(str);
                &#125;
                catch
                &#123;
                    textBox1.AppendText(&quot;[&quot; + DateTime.Now.ToString(&quot;HH:mm:ss&quot;) + &quot;]&quot; + &quot;-&gt;&quot;);
                    textBox1.AppendText(&quot;ASCII格式接收错误!\r\n&quot;);
                &#125;
            &#125;
            &#x2F;&#x2F; 接收格式为HEX
            else
            &#123;
                try
                &#123;
                    textBox1.AppendText(&quot;[&quot; + DateTime.Now.ToString(&quot;HH:mm:ss&quot;) + &quot;]&quot; + &quot;-&gt;&quot;);
                    byte[] data &#x3D; new byte[serialPort1.BytesToRead];   &#x2F;&#x2F; 定义缓冲区
                    serialPort1.Read(data, 0, data.Length);
                    &#x2F;&#x2F; 遍历
                    foreach (byte Number in data)
                    &#123;
                        string str &#x3D; Convert.ToString(Number, 16).ToUpper();
                        textBox1.AppendText((str.Length &#x3D;&#x3D; 1 ? &quot;0&quot; + str : str) + &quot; &quot;);
                    &#125;
                    textBox1.AppendText(&quot;\r\n&quot;);
                &#125;
                catch
                &#123;
                    textBox1.AppendText(&quot;[&quot; + DateTime.Now.ToString(&quot;HH:mm:ss&quot;) + &quot;]&quot; + &quot;-&gt;&quot;);
                    textBox1.AppendText(&quot;HEX格式接收错误!\r\n&quot;);
                &#125;
            &#125;
        &#125;
        &#x2F;&#x2F; 【清屏】
        private void button3_Click(object sender, EventArgs e)
        &#123;
            textBox1.Text &#x3D; &quot;&quot;;
        &#125;
        &#x2F;&#x2F; 【发送】
        private void button4_Click(object sender, EventArgs e)
        &#123;
            byte[] data &#x3D; new byte[1];

            &#x2F;&#x2F; 发送格式为ASCII
            if (!checkBox3.Checked)
            &#123;
                try
                &#123;
                    foreach (byte Number in textBox3.Text)
                    &#123;
                        data[0] &#x3D; Number;
                        serialPort1.Write(data, 0, 1);
                    &#125;
                &#125;
                catch
                &#123;
                    textBox1.AppendText(&quot;\r\n串口数据发送失败!!!\r\n&quot;);
                    textBox3.Text &#x3D; &quot;&quot;;
                    serialPort1.Close();
                    button2.BackgroundImage &#x3D; Properties.Resources.b1;
                    button2.Tag &#x3D; &quot;OFF&quot;;
                &#125;
            &#125;
            &#x2F;&#x2F; 发送格式为HEX
            else
            &#123;
                &#x2F;&#x2F; 处理字符串
                string Buf &#x3D; textBox3.Text;
                &#x2F;&#x2F; 去掉0x 0X
                Buf &#x3D; Buf.Replace(&quot;0x&quot;, string.Empty);
                Buf &#x3D; Buf.Replace(&quot;0X&quot;, string.Empty);
                Buf &#x3D; Buf.Replace(&quot; &quot;, string.Empty);

                textBox3.Text &#x3D; &quot;&quot;;
                &#x2F;&#x2F;循环发送，保证都是2位，1位就丢弃
                for (int i &#x3D; 0; i &lt; (Buf.Length - Buf.Length % 2) &#x2F; 2; i++)
                &#123;
                    textBox3.AppendText(Buf.Substring(i * 2, 2) + &quot; &quot;);
                    try
                    &#123;
                        &#x2F;&#x2F; 转换为16进制发送
                        data[0] &#x3D; Convert.ToByte(Buf.Substring(i * 2, 2), 16);
                        serialPort1.Write(data, 0, 1);
                    &#125;
                    catch
                    &#123;
                        textBox1.AppendText(&quot;\r\n串口数据发送失败!!!\r\n&quot;);
                        textBox3.Text &#x3D; &quot;&quot;;
                        serialPort1.Close();
                        button2.BackgroundImage &#x3D; Properties.Resources.b1;
                        button2.Tag &#x3D; &quot;OFF&quot;;
                    &#125;
                &#125;
            &#125;
        &#125;
        &#x2F;&#x2F; 清除发送
        private void button5_Click(object sender, EventArgs e)
        &#123;
            textBox3.Text &#x3D; &quot;&quot;;
        &#125;
    &#125;
&#125;
</code></pre>
              </div>
            </details>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://image-1309791158.cos.ap-guangzhou.myqcloud.com/%E5%85%B6%E4%BB%96/QQ%E6%88%AA%E5%9B%BE20230601173536.webp" alt=""></p>
<h2 id="第6讲">第6讲</h2>
<ul>
<li>软件设置保存与汉字显示方法</li>
</ul>
<blockquote>
<p>ini文件读取和写入：</p>
<pre class="line-numbers language-c#" data-language="c#"><code class="language-c#">[DllImport(&quot;kernel32&quot;)]
private static extern long WritePrivateProfileString(string section, string  key, string val, string filePath); &#x2F;&#x2F; 系统DLL导入ini写函数
[DllImport(&quot;kernel32&quot;)]
private static extern int GetPrivateProfileString(string section, string  key, string def, StringBuilder retVal, int size,  string filePath); &#x2F;&#x2F; 系统DLL导入ini读函数
string FileName &#x3D; System.AppDomain.CurrentDomain.BaseDirectory + &quot;Backup.ini&quot;;  &#x2F;&#x2F; ini文件名
StringBuilder BackupBuf &#x3D; new StringBuilder(50);    &#x2F;&#x2F; 存储读出的ini内容变量</code></pre>
<ul>
<li>
<p><code>WritePrivateProfileString</code> 函数用于在 INI 文件中写入配置项。它接受四个参数：</p>
<ul>
<li><code>section</code>：表示配置项所属的节（Section）名称；</li>
<li><code>key</code>：表示配置项的名称；</li>
<li><code>val</code>：表示配置项的值；</li>
<li><code>filePath</code>：表示 INI 文件的完整路径和文件名。</li>
</ul>
</li>
<li>
<p><code>GetPrivateProfileString</code> 函数用于从 INI 文件中读取配置项的值。它接受六个参数：</p>
<ul>
<li><code>section</code>：表示配置项所属的节名称；</li>
<li><code>key</code>：表示配置项的名称；</li>
<li><code>def</code>：表示如果没有找到指定的配置项，则返回的默认值；</li>
<li><code>retVal</code>：表示存储读取到的配置项值的 StringBuilder 对象；</li>
<li><code>size</code>：表示输入的 StringBuilder 对象可容纳的最大字符数；</li>
<li><code>filePath</code>：表示 INI 文件的完整路径和文件名。</li>
</ul>
</li>
<li>
<p><code>FileName</code>：表示 INI 文件的完整路径和文件名，它使用 <code>System.AppDomain.CurrentDomain.BaseDirectory</code> 获取应用程序根目录的路径，然后加上文件名 <code>&quot;Backup.ini&quot;</code> 组成完整路径。</p>
</li>
<li>
<p><code>BackupBuf</code>：表示存储读取到的 INI 配置项值的 StringBuilder 对象，它的容量为 50 个字符，用于存储较短的字符串类型的配置项值。</p>
</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://image-1309791158.cos.ap-guangzhou.myqcloud.com/%E5%85%B6%E4%BB%96/QQ%E6%88%AA%E5%9B%BE20230602092346.webp" alt=""></p>
</blockquote>
<details ><summary> Form1.cs </summary>
              <div class='content'>
              <pre class="line-numbers language-c#" data-language="c#"><code class="language-c#">using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Data;
using System.Drawing;
using System.Linq;
using System.Text;
using System.Windows.Forms;

&#x2F;&#x2F; 添加指令集
using System.IO.Ports;
using System.Runtime.InteropServices;


namespace TEST1
&#123;
    public partial class My_EXE : Form
    &#123;
        [DllImport(&quot;kernel32&quot;)]
        private static extern long WritePrivateProfileString(string section, string  key, string val, string filePath); &#x2F;&#x2F; 系统DLL导入ini写函数
        [DllImport(&quot;kernel32&quot;)]
        private static extern int GetPrivateProfileString(string section, string  key, string def, StringBuilder retVal,int size,  string filePath); &#x2F;&#x2F; 系统DLL导入ini读函数
        string FileName &#x3D; System.AppDomain.CurrentDomain.BaseDirectory + &quot;Backup.ini&quot;;  &#x2F;&#x2F; ini文件名
        StringBuilder BackupBuf &#x3D; new StringBuilder(50);    &#x2F;&#x2F; 存储读出的ini内容变量


        public My_EXE()
        &#123;
            InitializeComponent();
            &#x2F;&#x2F; 禁止这种异常的抛出(不加的话运行会报错)，避免出现跨线程访问控件
            System.Windows.Forms.Control.CheckForIllegalCrossThreadCalls &#x3D; false;
            &#x2F;&#x2F; 支持中文
            serialPort1.Encoding &#x3D; Encoding.GetEncoding(&quot;GB2312&quot;);
        &#125;
        private void flowLayoutPanel1_Paint(object sender, PaintEventArgs e)
        &#123;

        &#125;
        &#x2F;&#x2F;打开软件加载
        private void My_EXE_Load(object sender, EventArgs e)
        &#123;
            SearchAndAddSerialToComboBox(serialPort1, comboBox1);
            &#x2F;&#x2F; 恢复发送栏
            GetPrivateProfileString(&quot;串口1&quot;, &quot;发送栏&quot;, &quot;&quot;, BackupBuf, 50, FileName);
            textBox3.Text &#x3D; BackupBuf.ToString();
        &#125;
        &#x2F;&#x2F; 手动扫描并添加可用串口
        private void SearchAndAddSerialToComboBox(SerialPort MyPort, ComboBox MyBox)
        &#123;
            MyBox.Text &#x3D; &quot; &quot;;
            &#x2F;&#x2F; 获取本机串口列表
            string[] ComputerPortName &#x3D; SerialPort.GetPortNames();
            string BackupPort;

            &#x2F;&#x2F; 恢复端口号
            GetPrivateProfileString(&quot;串口1&quot;, &quot;端口号&quot;, &quot;&quot;, BackupBuf, 50, FileName);
            BackupPort &#x3D; BackupBuf.ToString();
            &#x2F;&#x2F;清空下拉框
            MyBox.Items.Clear();
            for (byte i &#x3D; 0; i &lt; ComputerPortName.Length; i++)
            &#123;
                try
                &#123;
                    MyPort.PortName &#x3D; ComputerPortName[i];
                    MyPort.Open();
                    MyBox.Items.Add(MyPort.PortName);
                    MyPort.Close();
                    &#x2F;&#x2F; 检查端口号是否有效,端口号初始化为备份端口号
                    if (BackupPort &#x3D;&#x3D; MyPort.PortName)
                    &#123;
                        comboBox1.Text &#x3D; BackupPort;
                    &#125;
                    &#x2F;&#x2F; 备份端口无效则默认第一个
                    if (MyBox.Text &#x3D;&#x3D; &quot;&quot;)
                    &#123;
                        MyBox.Text &#x3D; MyPort.PortName;
                    &#125;
                &#125;
                catch
                &#123;

                &#125;
            &#125;
            if (MyBox.Text &#x3D;&#x3D; &quot;&quot;)
            &#123;
                textBox1.AppendText(&quot;[&quot; + DateTime.Now.ToString(&quot;HH:mm:ss&quot;) + &quot;]&quot; + &quot;-&gt;&quot;);
                textBox1.AppendText(&quot;没有检测到串口工具!\r\n&quot;);
            &#125;
            &#x2F;&#x2F; 备份端口号
            WritePrivateProfileString(&quot;串口1&quot;, &quot;端口号&quot;, MyBox.Text, FileName);
        &#125;
        &#x2F;&#x2F;【手动扫描】
        private void button1_Click(object sender, EventArgs e)
        &#123;
            &#x2F;&#x2F; 先判断串口是否打开，打开了则要关闭再扫描
            if (serialPort1.IsOpen &#x3D;&#x3D; true)
            &#123;
                serialPort1.Close();
                button2.BackgroundImage &#x3D; Properties.Resources.b1;
                button2.Tag &#x3D; &quot;OFF&quot;;
                textBox1.AppendText(&quot;[&quot; + DateTime.Now.ToString(&quot;HH:mm:ss&quot;) + &quot;]&quot; + &quot;-&gt;&quot;);
                textBox1.AppendText(&quot;扫描并添加串口时关闭串口!\r\n&quot;);
            &#125;
            SearchAndAddSerialToComboBox(serialPort1, comboBox1);
        &#125;

        private void button2_Click(object sender, EventArgs e)
        &#123;
            if (button2.Tag.ToString() &#x3D;&#x3D; &quot;OFF&quot;)
            &#123;
                &#x2F;&#x2F; 打开串口
                try
                &#123;
                    serialPort1.PortName &#x3D; comboBox1.Text;
                    &#x2F;&#x2F; 把字符串波特率转换为32位波特率
                    serialPort1.BaudRate &#x3D; Convert.ToInt32(comboBox2.Text);
                    serialPort1.Open();
                    button2.BackgroundImage &#x3D; Properties.Resources.b2;
                    button2.Tag &#x3D; &quot;ON&quot;;
                    textBox1.AppendText(&quot;[&quot; + DateTime.Now.ToString(&quot;HH:mm:ss&quot;) + &quot;]&quot; + &quot;-&gt;&quot;);
                    textBox1.AppendText(&quot;手动打开串口!\r\n&quot;);
                    &#x2F;&#x2F; 开启定时器
                    timer1.Start();
                &#125;
                catch
                &#123;
                    serialPort1.Close();
                    button2.BackgroundImage &#x3D; Properties.Resources.b1;
                    button2.Tag &#x3D; &quot;OFF&quot;;
                    textBox1.AppendText(&quot;[&quot; + DateTime.Now.ToString(&quot;HH:mm:ss&quot;) + &quot;]&quot; + &quot;-&gt;&quot;);
                    textBox1.AppendText(&quot;串口打开失败!\r\n&quot;);
                    timer1.Stop();
                &#125;
            &#125;
            else
            &#123;
                &#x2F;&#x2F; 关闭串口
                serialPort1.Close();
                button2.BackgroundImage &#x3D; Properties.Resources.b1;
                button2.Tag &#x3D; &quot;OFF&quot;;
                textBox1.AppendText(&quot;[&quot; + DateTime.Now.ToString(&quot;HH:mm:ss&quot;) + &quot;]&quot; + &quot;-&gt;&quot;);
                textBox1.AppendText(&quot;手动关闭串口!\r\n&quot;);
                timer1.Stop();
            &#125;
        &#125;
        &#x2F;&#x2F;【下拉框发生变化】
        private void comboBox1_SelectedIndexChanged(object sender, EventArgs e)
        &#123;
            if (serialPort1.IsOpen &#x3D;&#x3D; true)
            &#123;
                serialPort1.Close();
                try
                &#123;
                    serialPort1.PortName &#x3D; comboBox1.Text;
                    serialPort1.Open();
                    button2.BackgroundImage &#x3D; Properties.Resources.b2;
                    button2.Tag &#x3D; &quot;ON&quot;;
                    textBox1.AppendText(&quot;[&quot; + DateTime.Now.ToString(&quot;HH:mm:ss&quot;) + &quot;]&quot; + &quot;-&gt;&quot;);
                    textBox1.AppendText(&quot;串口更换成功!\r\n&quot;);
                &#125;
                catch
                &#123;
                    serialPort1.Close();
                    button2.BackgroundImage &#x3D; Properties.Resources.b1;
                    button2.Tag &#x3D; &quot;OFF&quot;;
                    textBox1.AppendText(&quot;[&quot; + DateTime.Now.ToString(&quot;HH:mm:ss&quot;) + &quot;]&quot; + &quot;-&gt;&quot;);
                    textBox1.AppendText(&quot;串口更换失败!\r\n&quot;);
                &#125;
            &#125;
            &#x2F;&#x2F; 备份端口号
            WritePrivateProfileString(&quot;串口1&quot;, &quot;端口号&quot;, comboBox1.Text, FileName);
        &#125;
        &#x2F;&#x2F;【定时器扫描】
        private void timer1_Tick(object sender, EventArgs e)
        &#123;
            if (!serialPort1.IsOpen)
            &#123;
                serialPort1.Close();
                button2.BackgroundImage &#x3D; Properties.Resources.b1;
                button2.Tag &#x3D; &quot;OFF&quot;;
                &#x2F;&#x2F; 重新扫描并添加串口
                SearchAndAddSerialToComboBox(serialPort1, comboBox1);
            &#125;
        &#125;
        &#x2F;&#x2F; 串口接收
        private void serialPort1_DataReceived(object sender, SerialDataReceivedEventArgs e)
        &#123;
            &#x2F;&#x2F; 接格式为ASCII
            if (!checkBox1.Checked)
            &#123;
                try
                &#123;
                    textBox1.AppendText(&quot;[&quot; + DateTime.Now.ToString(&quot;HH:mm:ss&quot;) + &quot;]&quot; + &quot;-&gt;&quot;);
                    string str &#x3D; serialPort1.ReadExisting();    &#x2F;&#x2F; 以字符串格式读
                    textBox1.AppendText(str);
                &#125;
                catch
                &#123;
                    textBox1.AppendText(&quot;[&quot; + DateTime.Now.ToString(&quot;HH:mm:ss&quot;) + &quot;]&quot; + &quot;-&gt;&quot;);
                    textBox1.AppendText(&quot;ASCII格式接收错误!\r\n&quot;);
                &#125;
            &#125;
            &#x2F;&#x2F; 接收格式为HEX
            else
            &#123;
                try
                &#123;
                    textBox1.AppendText(&quot;[&quot; + DateTime.Now.ToString(&quot;HH:mm:ss&quot;) + &quot;]&quot; + &quot;-&gt;&quot;);
                    byte[] data &#x3D; new byte[serialPort1.BytesToRead];   &#x2F;&#x2F; 定义缓冲区
                    serialPort1.Read(data, 0, data.Length);
                    &#x2F;&#x2F; 遍历
                    foreach (byte Number in data)
                    &#123;
                        string str &#x3D; Convert.ToString(Number, 16).ToUpper();
                        textBox1.AppendText((str.Length &#x3D;&#x3D; 1 ? &quot;0&quot; + str : str) + &quot; &quot;);
                    &#125;
                    textBox1.AppendText(&quot;\r\n&quot;);
                &#125;
                catch
                &#123;
                    textBox1.AppendText(&quot;[&quot; + DateTime.Now.ToString(&quot;HH:mm:ss&quot;) + &quot;]&quot; + &quot;-&gt;&quot;);
                    textBox1.AppendText(&quot;HEX格式接收错误!\r\n&quot;);
                &#125;
            &#125;
        &#125;
        &#x2F;&#x2F; 【清屏】
        private void button3_Click(object sender, EventArgs e)
        &#123;
            textBox1.Text &#x3D; &quot;&quot;;
        &#125;
        &#x2F;&#x2F; CRC计算
        private UInt16 Crc_Check(byte[] Data, byte DataLEN)
        &#123;
            UInt16 CRC &#x3D; 0xFFFF;

            for(byte i &#x3D; 0; i &lt; DataLEN; i++)
            &#123;
                CRC &#x3D; Data[i];
                for(byte j &#x3D; 0;j &lt; 8; j++)
                &#123;
                    if((CRC &amp; 0x0001) &#x3D;&#x3D; 0x0001)
                    &#123;
                        CRC &#x3D; (UInt16)((CRC &gt;&gt; 1) ^ 0xA001);
                    &#125;
                    else
                    &#123;
                        CRC &#x3D; (UInt16)(CRC &gt;&gt; 1);
                    &#125;
                &#125;
            &#125;
            CRC &#x3D; (UInt16)((CRC &gt;&gt; 8) + (CRC &lt;&lt; 8));
            return CRC;
        &#125;
        &#x2F;&#x2F; 【发送】
        private void button4_Click(object sender, EventArgs e)
        &#123;
            byte[] data &#x3D; new byte[1];

            &#x2F;&#x2F; 发送格式为ASCII
            if (!checkBox3.Checked)
            &#123;
                try
                &#123;
                    &#x2F;&#x2F; 支持中文
                    Encoding Chinese &#x3D; System.Text.Encoding.GetEncoding(&quot;GB2312&quot;);
                    byte[] SendByte &#x3D; Chinese.GetBytes(textBox3.Text);

                    foreach (byte Number in SendByte)
                    &#123;
                        data[0] &#x3D; Number;
                        serialPort1.Write(data, 0, 1);
                    &#125;
                    &#x2F;&#x2F;发送新行
                    if (checkBox5.Checked)
                    &#123;
                        data[0] &#x3D; 0x0D;
                        serialPort1.Write(data, 0, 1);  &#x2F;&#x2F; 发送回车
                        data[0] &#x3D; 0x0A;
                        serialPort1.Write(data, 0, 1);  &#x2F;&#x2F; 发送换行
                    &#125;
                &#125;
                catch
                &#123;
                    textBox1.AppendText(&quot;\r\n串口数据发送失败!!!\r\n&quot;);
                    serialPort1.Close();
                    button2.BackgroundImage &#x3D; Properties.Resources.b1;
                    button2.Tag &#x3D; &quot;OFF&quot;;
                &#125;
            &#125;
            &#x2F;&#x2F; 发送格式为HEX
            else
            &#123;
                &#x2F;&#x2F; 处理字符串
                string Buf &#x3D; textBox3.Text;
                &#x2F;&#x2F; 去掉0x 0X
                Buf &#x3D; Buf.Replace(&quot;0x&quot;, string.Empty);
                Buf &#x3D; Buf.Replace(&quot;0X&quot;, string.Empty);
                Buf &#x3D; Buf.Replace(&quot; &quot;, string.Empty);
                byte[] Calculate_CRC &#x3D; new byte[(Buf.Length - Buf.Length % 2) &#x2F; 2];
                textBox3.Text &#x3D; &quot;&quot;;
                &#x2F;&#x2F;循环发送，保证都是2位，1位就丢弃
                for (int i &#x3D; 0; i &lt; (Buf.Length - Buf.Length % 2) &#x2F; 2; i++)
                &#123;
                    textBox3.AppendText(Buf.Substring(i * 2, 2) + &quot; &quot;);
                    try
                    &#123;
                        &#x2F;&#x2F; 转换为16进制发送
                        data[0] &#x3D; Convert.ToByte(Buf.Substring(i * 2, 2), 16);
                        serialPort1.Write(data, 0, 1);
                        Calculate_CRC[i] &#x3D; data[0];
                    &#125;
                    catch
                    &#123;
                        textBox1.AppendText(&quot;\r\n串口数据发送失败!!!\r\n&quot;);
                        serialPort1.Close();
                        button2.BackgroundImage &#x3D; Properties.Resources.b1;
                        button2.Tag &#x3D; &quot;OFF&quot;;
                    &#125;
                &#125;
                &#x2F;&#x2F; 发送CRC
                if (checkBox4.Checked &#x3D;&#x3D; true)
                &#123;
                    UInt32 CRC &#x3D; Crc_Check(Calculate_CRC, (byte)Calculate_CRC.Length);
                    byte CRC_H &#x3D; (byte)(CRC &gt;&gt; 8);
                    byte CRC_L &#x3D; (byte)CRC;

                    try
                    &#123;
                        data[0] &#x3D; CRC_L;
                        serialPort1.Write(data, 0, 1);  &#x2F;&#x2F; 发送低位
                        data[0] &#x3D; CRC_H;
                        serialPort1.Write(data, 0, 1);  &#x2F;&#x2F; 发送高位
                    &#125;
                    catch
                    &#123;
                        textBox1.AppendText(&quot;\r\n串口数据发送失败!!!\r\n&quot;);
                        serialPort1.Close();
                        button2.BackgroundImage &#x3D; Properties.Resources.b1;
                        button2.Tag &#x3D; &quot;OFF&quot;;
                    &#125;
                &#125;

            &#125;
            if (checkBox6.Checked)
            &#123;
                textBox3.Text &#x3D; &quot; &quot;;
            &#125;
        &#125;
        &#x2F;&#x2F; 清除发送
        private void button5_Click(object sender, EventArgs e)
        &#123;
            textBox3.Text &#x3D; &quot;&quot;;
        &#125;

        private void checkBox3_CheckedChanged(object sender, EventArgs e)
        &#123;
            &#x2F;&#x2F;HEX发送
            if (checkBox3.Checked &#x3D;&#x3D; true)
            &#123;
                &#x2F;&#x2F;CRC有效
                checkBox4.Enabled &#x3D; true;
                &#x2F;&#x2F; 回车换行无效
                checkBox5.Enabled &#x3D; false;
            &#125;
                &#x2F;&#x2F;ASCII发送
            else
            &#123;
                &#x2F;&#x2F;CRC无效
                checkBox4.Enabled &#x3D; false;
                &#x2F;&#x2F; 回车换行有效
                checkBox5.Enabled &#x3D; true;
            &#125;
        &#125;

        private void textBox3_TextChanged(object sender, EventArgs e)
        &#123;
            &#x2F;&#x2F; 备份发送栏
            WritePrivateProfileString(&quot;串口1&quot;, &quot;发送栏&quot;, textBox3.Text, FileName);
        &#125;
    &#125;
&#125;
</code></pre>
              </div>
            </details>
<h2 id="第7讲">第7讲</h2>
<ul>
<li>统计接收/发送，定时发送，断帧功能</li>
</ul>
<details ><summary> Form1.cs </summary>
              <div class='content'>
              <pre class="line-numbers language-c#" data-language="c#"><code class="language-c#">using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Data;
using System.Drawing;
using System.Linq;
using System.Text;
using System.Windows.Forms;

&#x2F;&#x2F; 添加指令集
using System.IO.Ports;
using System.Runtime.InteropServices;


namespace TEST1
&#123;
    public partial class My_EXE : Form
    &#123;
        [DllImport(&quot;kernel32&quot;)]
        private static extern long WritePrivateProfileString(string section, string  key, string val, string filePath); &#x2F;&#x2F; 系统DLL导入ini写函数
        [DllImport(&quot;kernel32&quot;)]
        private static extern int GetPrivateProfileString(string section, string  key, string def, StringBuilder retVal,int size,  string filePath); &#x2F;&#x2F; 系统DLL导入ini读函数
        string FileName &#x3D; System.AppDomain.CurrentDomain.BaseDirectory + &quot;Backup.ini&quot;;  &#x2F;&#x2F; ini文件名
        StringBuilder BackupBuf &#x3D; new StringBuilder(50);    &#x2F;&#x2F; 存储读出的ini内容变量

        bool Timer3_Flag &#x3D; false;   &#x2F;&#x2F; 用于串口通讯断帧

        public My_EXE()
        &#123;
            InitializeComponent();
            &#x2F;&#x2F; 禁止这种异常的抛出(不加的话运行会报错)，避免出现跨线程访问控件
            System.Windows.Forms.Control.CheckForIllegalCrossThreadCalls &#x3D; false;
            &#x2F;&#x2F; 支持中文
            serialPort1.Encoding &#x3D; Encoding.GetEncoding(&quot;GB2312&quot;);
        &#125;
        private void flowLayoutPanel1_Paint(object sender, PaintEventArgs e)
        &#123;

        &#125;
        &#x2F;&#x2F;打开软件加载
        private void My_EXE_Load(object sender, EventArgs e)
        &#123;
            SearchAndAddSerialToComboBox(serialPort1, comboBox1);
            &#x2F;&#x2F; 恢复发送栏
            GetPrivateProfileString(&quot;串口1&quot;, &quot;发送栏&quot;, &quot;&quot;, BackupBuf, 50, FileName);
            textBox3.Text &#x3D; BackupBuf.ToString();
        &#125;
        &#x2F;&#x2F; 手动扫描并添加可用串口
        private void SearchAndAddSerialToComboBox(SerialPort MyPort, ComboBox MyBox)
        &#123;
            MyBox.Text &#x3D; &quot; &quot;;
            &#x2F;&#x2F; 获取本机串口列表
            string[] ComputerPortName &#x3D; SerialPort.GetPortNames();
            string BackupPort;

            &#x2F;&#x2F; 恢复端口号
            GetPrivateProfileString(&quot;串口1&quot;, &quot;端口号&quot;, &quot;&quot;, BackupBuf, 50, FileName);
            BackupPort &#x3D; BackupBuf.ToString();
            &#x2F;&#x2F;清空下拉框
            MyBox.Items.Clear();
            for (byte i &#x3D; 0; i &lt; ComputerPortName.Length; i++)
            &#123;
                try
                &#123;
                    MyPort.PortName &#x3D; ComputerPortName[i];
                    MyPort.Open();
                    MyBox.Items.Add(MyPort.PortName);
                    MyPort.Close();
                    &#x2F;&#x2F; 检查端口号是否有效,端口号初始化为备份端口号
                    if (BackupPort &#x3D;&#x3D; MyPort.PortName)
                    &#123;
                        comboBox1.Text &#x3D; BackupPort;
                    &#125;
                    &#x2F;&#x2F; 备份端口无效则默认第一个
                    if (MyBox.Text &#x3D;&#x3D; &quot;&quot;)
                    &#123;
                        MyBox.Text &#x3D; MyPort.PortName;
                    &#125;
                &#125;
                catch
                &#123;

                &#125;
            &#125;
            if (MyBox.Text &#x3D;&#x3D; &quot;&quot;)
            &#123;
                textBox1.AppendText(&quot;[&quot; + DateTime.Now.ToString(&quot;HH:mm:ss&quot;) + &quot;]&quot; + &quot;-&gt;&quot;);
                textBox1.AppendText(&quot;没有检测到串口工具!\r\n&quot;);
            &#125;
            &#x2F;&#x2F; 备份端口号
            WritePrivateProfileString(&quot;串口1&quot;, &quot;端口号&quot;, MyBox.Text, FileName);
        &#125;
        &#x2F;&#x2F;【手动扫描】
        private void button1_Click(object sender, EventArgs e)
        &#123;
            &#x2F;&#x2F; 先判断串口是否打开，打开了则要关闭再扫描
            if (serialPort1.IsOpen &#x3D;&#x3D; true)
            &#123;
                serialPort1.Close();
                button2.BackgroundImage &#x3D; Properties.Resources.b1;
                button2.Tag &#x3D; &quot;OFF&quot;;
                textBox1.AppendText(&quot;[&quot; + DateTime.Now.ToString(&quot;HH:mm:ss&quot;) + &quot;]&quot; + &quot;-&gt;&quot;);
                textBox1.AppendText(&quot;扫描并添加串口时关闭串口!\r\n&quot;);
            &#125;
            SearchAndAddSerialToComboBox(serialPort1, comboBox1);
        &#125;

        private void button2_Click(object sender, EventArgs e)
        &#123;
            if (button2.Tag.ToString() &#x3D;&#x3D; &quot;OFF&quot;)
            &#123;
                &#x2F;&#x2F; 打开串口
                try
                &#123;
                    serialPort1.PortName &#x3D; comboBox1.Text;
                    &#x2F;&#x2F; 把字符串波特率转换为32位波特率
                    serialPort1.BaudRate &#x3D; Convert.ToInt32(comboBox2.Text);
                    serialPort1.Open();
                    button2.BackgroundImage &#x3D; Properties.Resources.b2;
                    button2.Tag &#x3D; &quot;ON&quot;;
                    textBox1.AppendText(&quot;[&quot; + DateTime.Now.ToString(&quot;HH:mm:ss&quot;) + &quot;]&quot; + &quot;-&gt;&quot;);
                    textBox1.AppendText(&quot;手动打开串口!\r\n&quot;);
                    &#x2F;&#x2F; 开启定时器
                    timer1.Start();
                &#125;
                catch
                &#123;
                    serialPort1.Close();
                    button2.BackgroundImage &#x3D; Properties.Resources.b1;
                    button2.Tag &#x3D; &quot;OFF&quot;;
                    textBox1.AppendText(&quot;[&quot; + DateTime.Now.ToString(&quot;HH:mm:ss&quot;) + &quot;]&quot; + &quot;-&gt;&quot;);
                    textBox1.AppendText(&quot;串口打开失败!\r\n&quot;);
                    timer1.Stop();
                &#125;
            &#125;
            else
            &#123;
                &#x2F;&#x2F; 关闭串口
                serialPort1.Close();
                button2.BackgroundImage &#x3D; Properties.Resources.b1;
                button2.Tag &#x3D; &quot;OFF&quot;;
                textBox1.AppendText(&quot;[&quot; + DateTime.Now.ToString(&quot;HH:mm:ss&quot;) + &quot;]&quot; + &quot;-&gt;&quot;);
                textBox1.AppendText(&quot;手动关闭串口!\r\n&quot;);
                timer1.Stop();
            &#125;
        &#125;
        &#x2F;&#x2F;【下拉框发生变化】
        private void comboBox1_SelectedIndexChanged(object sender, EventArgs e)
        &#123;
            if (serialPort1.IsOpen &#x3D;&#x3D; true)
            &#123;
                serialPort1.Close();
                try
                &#123;
                    serialPort1.PortName &#x3D; comboBox1.Text;
                    serialPort1.Open();
                    button2.BackgroundImage &#x3D; Properties.Resources.b2;
                    button2.Tag &#x3D; &quot;ON&quot;;
                    textBox1.AppendText(&quot;[&quot; + DateTime.Now.ToString(&quot;HH:mm:ss&quot;) + &quot;]&quot; + &quot;-&gt;&quot;);
                    textBox1.AppendText(&quot;串口更换成功!\r\n&quot;);
                &#125;
                catch
                &#123;
                    serialPort1.Close();
                    button2.BackgroundImage &#x3D; Properties.Resources.b1;
                    button2.Tag &#x3D; &quot;OFF&quot;;
                    textBox1.AppendText(&quot;[&quot; + DateTime.Now.ToString(&quot;HH:mm:ss&quot;) + &quot;]&quot; + &quot;-&gt;&quot;);
                    textBox1.AppendText(&quot;串口更换失败!\r\n&quot;);
                &#125;
            &#125;
            &#x2F;&#x2F; 备份端口号
            WritePrivateProfileString(&quot;串口1&quot;, &quot;端口号&quot;, comboBox1.Text, FileName);
        &#125;
        &#x2F;&#x2F;【定时器扫描】
        private void timer1_Tick(object sender, EventArgs e)
        &#123;
            if (!serialPort1.IsOpen)
            &#123;
                serialPort1.Close();
                button2.BackgroundImage &#x3D; Properties.Resources.b1;
                button2.Tag &#x3D; &quot;OFF&quot;;
                &#x2F;&#x2F; 重新扫描并添加串口
                SearchAndAddSerialToComboBox(serialPort1, comboBox1);
            &#125;
        &#125;
        &#x2F;&#x2F; 串口接收
        private void serialPort1_DataReceived(object sender, SerialDataReceivedEventArgs e)
        &#123;
            &#x2F;&#x2F; 接格式为ASCII
            if (!checkBox1.Checked)
            &#123;
                try
                &#123;
                    textBox1.AppendText(&quot;[&quot; + DateTime.Now.ToString(&quot;HH:mm:ss&quot;) + &quot;]&quot; + &quot;-&gt;&quot;);
                    string str &#x3D; serialPort1.ReadExisting();    &#x2F;&#x2F; 以字符串格式读
                    textBox1.AppendText(str);

                    &#x2F;&#x2F; 统计接收字节数
                    UInt32 RBytes &#x3D; Convert.ToUInt32(textBox5.Text, 10);    &#x2F;&#x2F; 定义接收字节数变量并初始化为已接收字节数
                    RBytes +&#x3D; (UInt32)str.Length;   &#x2F;&#x2F; 加
                    textBox5.Text &#x3D; Convert.ToString(RBytes, 10);   &#x2F;&#x2F; 转换为字符串
                &#125;
                catch
                &#123;
                    textBox1.AppendText(&quot;[&quot; + DateTime.Now.ToString(&quot;HH:mm:ss&quot;) + &quot;]&quot; + &quot;-&gt;&quot;);
                    textBox1.AppendText(&quot;ASCII格式接收错误!\r\n&quot;);
                &#125;
            &#125;
            &#x2F;&#x2F; 接收格式为HEX
            else
            &#123;
                try
                &#123;
                    &#x2F;&#x2F; 断帧
                    if (Timer3_Flag)
                    &#123;
                        Timer3_Flag &#x3D; false;
                        textBox1.AppendText(&quot;\r\n&quot;);
                        textBox1.AppendText(&quot;[&quot; + DateTime.Now.ToString(&quot;HH:mm:ss&quot;) + &quot;]&quot; + &quot;-&gt;&quot;);
                    &#125;

                    byte[] data &#x3D; new byte[serialPort1.BytesToRead];   &#x2F;&#x2F; 定义缓冲区
                    serialPort1.Read(data, 0, data.Length);
                    &#x2F;&#x2F; 遍历
                    foreach (byte Number in data)
                    &#123;
                        string str &#x3D; Convert.ToString(Number, 16).ToUpper();
                        textBox1.AppendText((str.Length &#x3D;&#x3D; 1 ? &quot;0&quot; + str : str) + &quot; &quot;);
                    &#125;
                    &#x2F;&#x2F; 
                    &#x2F;&#x2F; 统计接收字节数
                    UInt32 RBytes &#x3D; Convert.ToUInt32(textBox5.Text, 10);    &#x2F;&#x2F; 定义接收字节数变量并初始化为已接收字节数
                    RBytes +&#x3D; (UInt32)data.Length;   &#x2F;&#x2F; 加
                    textBox5.Text &#x3D; Convert.ToString(RBytes, 10);   &#x2F;&#x2F; 转换为字符串
                &#125;
                catch
                &#123;
                    textBox1.AppendText(&quot;[&quot; + DateTime.Now.ToString(&quot;HH:mm:ss&quot;) + &quot;]&quot; + &quot;-&gt;&quot;);
                    textBox1.AppendText(&quot;HEX格式接收错误!\r\n&quot;);
                &#125;
            &#125;
        &#125;
        &#x2F;&#x2F; 【清屏】
        private void button3_Click(object sender, EventArgs e)
        &#123;
            textBox1.Text &#x3D; &quot;&quot;;
            textBox4.Text &#x3D; &quot;0&quot;;
            textBox5.Text &#x3D; &quot;0&quot;;
        &#125;
        &#x2F;&#x2F; CRC计算
        private UInt16 Crc_Check(byte[] Data, byte DataLEN)
        &#123;
            UInt16 CRC &#x3D; 0xFFFF;

            for(byte i &#x3D; 0; i &lt; DataLEN; i++)
            &#123;
                CRC &#x3D; Data[i];
                for(byte j &#x3D; 0;j &lt; 8; j++)
                &#123;
                    if((CRC &amp; 0x0001) &#x3D;&#x3D; 0x0001)
                    &#123;
                        CRC &#x3D; (UInt16)((CRC &gt;&gt; 1) ^ 0xA001);
                    &#125;
                    else
                    &#123;
                        CRC &#x3D; (UInt16)(CRC &gt;&gt; 1);
                    &#125;
                &#125;
            &#125;
            CRC &#x3D; (UInt16)((CRC &gt;&gt; 8) + (CRC &lt;&lt; 8));
            return CRC;
        &#125;
        &#x2F;&#x2F; 【发送】
        private void button4_Click(object sender, EventArgs e)
        &#123;
            byte[] data &#x3D; new byte[1];

            &#x2F;&#x2F; 发送格式为ASCII
            if (!checkBox3.Checked)
            &#123;
                try
                &#123;
                    &#x2F;&#x2F; 支持中文
                    Encoding Chinese &#x3D; System.Text.Encoding.GetEncoding(&quot;GB2312&quot;);
                    byte[] SendByte &#x3D; Chinese.GetBytes(textBox3.Text);

                    foreach (byte Number in SendByte)
                    &#123;
                        data[0] &#x3D; Number;
                        serialPort1.Write(data, 0, 1);
                    &#125;
                    &#x2F;&#x2F;发送新行
                    if (checkBox5.Checked)
                    &#123;
                        data[0] &#x3D; 0x0D;
                        serialPort1.Write(data, 0, 1);  &#x2F;&#x2F; 发送回车
                        data[0] &#x3D; 0x0A;
                        serialPort1.Write(data, 0, 1);  &#x2F;&#x2F; 发送换行
                    &#125;
                    &#x2F;&#x2F;统计发送字节数(先把当前已发送的字节转换为32位)
                    UInt32 SBytes &#x3D; Convert.ToUInt32(textBox4.Text, 10);
                    SBytes +&#x3D; (UInt32)SendByte.Length;
                    &#x2F;&#x2F; 加回车换行2个 字节
                    if (checkBox5.Checked)
                    &#123;
                        SBytes +&#x3D; 2;
                    &#125;
                    textBox4.Text &#x3D; Convert.ToString(SBytes, 10);
                &#125;
                catch
                &#123;
                    textBox1.AppendText(&quot;\r\n串口数据发送失败!!!\r\n&quot;);
                    serialPort1.Close();
                    button2.BackgroundImage &#x3D; Properties.Resources.b1;
                    button2.Tag &#x3D; &quot;OFF&quot;;
                &#125;
            &#125;
            &#x2F;&#x2F; 发送格式为HEX
            else
            &#123;
                &#x2F;&#x2F; 处理字符串
                string Buf &#x3D; textBox3.Text;
                &#x2F;&#x2F; 去掉0x 0X
                Buf &#x3D; Buf.Replace(&quot;0x&quot;, string.Empty);
                Buf &#x3D; Buf.Replace(&quot;0X&quot;, string.Empty);
                Buf &#x3D; Buf.Replace(&quot; &quot;, string.Empty);
                byte[] Calculate_CRC &#x3D; new byte[(Buf.Length - Buf.Length % 2) &#x2F; 2];
                textBox3.Text &#x3D; &quot;&quot;;
                &#x2F;&#x2F;循环发送，保证都是2位，1位就丢弃
                for (int i &#x3D; 0; i &lt; (Buf.Length - Buf.Length % 2) &#x2F; 2; i++)
                &#123;
                    textBox3.AppendText(Buf.Substring(i * 2, 2) + &quot; &quot;);
                    try
                    &#123;
                        &#x2F;&#x2F; 转换为16进制发送
                        data[0] &#x3D; Convert.ToByte(Buf.Substring(i * 2, 2), 16);
                        serialPort1.Write(data, 0, 1);
                        Calculate_CRC[i] &#x3D; data[0];
                    &#125;
                    catch
                    &#123;
                        textBox1.AppendText(&quot;\r\n串口数据发送失败!!!\r\n&quot;);
                        serialPort1.Close();
                        button2.BackgroundImage &#x3D; Properties.Resources.b1;
                        button2.Tag &#x3D; &quot;OFF&quot;;
                    &#125;
                &#125;
                &#x2F;&#x2F; 发送CRC
                if (checkBox4.Checked &#x3D;&#x3D; true)
                &#123;
                    UInt32 CRC &#x3D; Crc_Check(Calculate_CRC, (byte)Calculate_CRC.Length);
                    byte CRC_H &#x3D; (byte)(CRC &gt;&gt; 8);
                    byte CRC_L &#x3D; (byte)CRC;

                    try
                    &#123;
                        data[0] &#x3D; CRC_L;
                        serialPort1.Write(data, 0, 1);  &#x2F;&#x2F; 发送低位
                        data[0] &#x3D; CRC_H;
                        serialPort1.Write(data, 0, 1);  &#x2F;&#x2F; 发送高位
                    &#125;
                    catch
                    &#123;
                        textBox1.AppendText(&quot;\r\n串口数据发送失败!!!\r\n&quot;);
                        serialPort1.Close();
                        button2.BackgroundImage &#x3D; Properties.Resources.b1;
                        button2.Tag &#x3D; &quot;OFF&quot;;
                    &#125;
                &#125;
                &#x2F;&#x2F;统计发送字节数
                UInt32 SBytes &#x3D; Convert.ToUInt32(textBox4.Text,10);
                SBytes +&#x3D; (UInt32)Calculate_CRC.Length;
                &#x2F;&#x2F; 如果有CRC则加多2个 字节
                if (checkBox4.Checked)
                &#123;
                    SBytes +&#x3D; 2;
                &#125;
                textBox4.Text &#x3D; Convert.ToString(SBytes, 10);
            &#125;
            if (checkBox6.Checked)
            &#123;
                textBox3.Text &#x3D; &quot; &quot;;
            &#125;
        &#125;
        &#x2F;&#x2F; 清除发送
        private void button5_Click(object sender, EventArgs e)
        &#123;
            textBox3.Text &#x3D; &quot;&quot;;
        &#125;

        private void checkBox3_CheckedChanged(object sender, EventArgs e)
        &#123;
            &#x2F;&#x2F;HEX发送
            if (checkBox3.Checked &#x3D;&#x3D; true)
            &#123;
                &#x2F;&#x2F;CRC有效
                checkBox4.Enabled &#x3D; true;
                &#x2F;&#x2F; 回车换行无效
                checkBox5.Enabled &#x3D; false;
            &#125;
                &#x2F;&#x2F;ASCII发送
            else
            &#123;
                &#x2F;&#x2F;CRC无效
                checkBox4.Enabled &#x3D; false;
                &#x2F;&#x2F; 回车换行有效
                checkBox5.Enabled &#x3D; true;
            &#125;
        &#125;

        private void textBox3_TextChanged(object sender, EventArgs e)
        &#123;
            &#x2F;&#x2F; 备份发送栏
            WritePrivateProfileString(&quot;串口1&quot;, &quot;发送栏&quot;, textBox3.Text, FileName);
        &#125;

        private void checkBox2_CheckedChanged(object sender, EventArgs e)
        &#123;
            &#x2F;&#x2F; 启动定时发送
            if (checkBox2.Checked)
            &#123;
                textBox1.AppendText(&quot;[&quot; + DateTime.Now.ToString(&quot;HH:mm:ss&quot;) + &quot;]&quot; + &quot;-&gt;&quot;);
                textBox1.AppendText(&quot;启动定时发送!!!\r\n&quot;);

                &#x2F;&#x2F; 设置时间
                try
                &#123;
                    timer2.Interval &#x3D; Convert.ToUInt16(textBox2.Text, 10);
                &#125;
                catch
                &#123;
                    MessageBox.Show(&quot;输入时间有误，设定为默认值&quot;, &quot;提示&quot;);
                    textBox2.Text &#x3D; &quot;1000&quot;;
                    timer2.Interval &#x3D; 1000;
                &#125;
                &#x2F;&#x2F; 启动定时器2
                timer2.Start();
            &#125;
            &#x2F;&#x2F; 关闭定时发送
            else
            &#123;
                textBox1.AppendText(&quot;[&quot; + DateTime.Now.ToString(&quot;HH:mm:ss&quot;) + &quot;]&quot; + &quot;-&gt;&quot;);
                textBox1.AppendText(&quot;关闭定时发送!!!\r\n&quot;);
                &#x2F;&#x2F; 关闭定时器
                timer2.Stop();
            &#125;
        &#125;

        private void timer2_Tick(object sender, EventArgs e)
        &#123;
            &#x2F;&#x2F; 触发按钮4单击事件
            button4.PerformClick();
        &#125;

        private void textBox2_TextChanged(object sender, EventArgs e)
        &#123;
            &#x2F;&#x2F; 设置时间
            try
            &#123;
                timer2.Interval &#x3D; Convert.ToUInt16(textBox2.Text, 10);
            &#125;
            catch
            &#123;
                MessageBox.Show(&quot;输入时间有误，设定为默认值&quot;, &quot;提示&quot;);
                textBox2.Text &#x3D; &quot;1000&quot;;
                timer2.Interval &#x3D; 1000;
            &#125;
        &#125;

        private void checkBox1_CheckedChanged(object sender, EventArgs e)
        &#123;
            &#x2F;&#x2F; 启动与禁用断帧功能
            if (checkBox1.Checked)
            &#123;
                textBox6.Enabled &#x3D; true;
                &#x2F;&#x2F; 启动定时器3
                try
                &#123;
                    timer3.Interval &#x3D; Convert.ToUInt16(textBox6.Text, 10);
                    timer3.Start();
                &#125;
                catch
                &#123;
                    MessageBox.Show(&quot;输入时间有误，设定为默认值&quot;, &quot;提示&quot;);
                    textBox3.Text &#x3D; &quot;500&quot;;
                    timer3.Interval &#x3D; 500;
                &#125;
            &#125;
            else
            &#123;
                textBox6.Enabled &#x3D; false;
                timer3.Stop();
            &#125;
        &#125;
        &#x2F;&#x2F; 定时器3中断
        private void timer3_Tick(object sender, EventArgs e)
        &#123;
            Timer3_Flag &#x3D; true;
        &#125;
        &#x2F;&#x2F; 设置定时器3时间
        private void textBox6_TextChanged(object sender, EventArgs e)
        &#123;
            try
            &#123;
                timer3.Interval &#x3D; Convert.ToUInt16(textBox6.Text, 10);
            &#125;
            catch
            &#123;
                MessageBox.Show(&quot;输入时间有误，设定为默认值&quot;, &quot;提示&quot;);
                textBox6.Text &#x3D; &quot;500&quot;;
                timer3.Interval &#x3D; 500;
            &#125;
        &#125;

        private void comboBox2_SelectedIndexChanged(object sender, EventArgs e)
        &#123;
            serialPort1.BaudRate &#x3D; Convert.ToInt32(comboBox2.Text);
        &#125;
    &#125;
&#125;
</code></pre>
              </div>
            </details>
<h2 id="第8讲">第8讲</h2>
<ul>
<li>多窗体设计</li>
</ul>
<details ><summary> Form1.cs </summary>
              <div class='content'>
              <pre class="line-numbers language-c#" data-language="c#"><code class="language-c#">namespace TEST1
&#123;
    public partial class My_EXE : Form
    &#123;
         private static Form2 Form2; &#x2F;&#x2F; 定义一个子窗体变量，供主窗体使用
        &#x2F;&#x2F;..............
                private void button6_Click(object sender, EventArgs e)
        &#123;
            &#x2F;&#x2F; 第一次创建
            if (null &#x3D;&#x3D; Form2)
            &#123;
                &#x2F;&#x2F; 新建窗体
                Form2 &#x3D; new Form2();
            &#125;
            else
            &#123;
                &#x2F;&#x2F; 如果释放了就新建
                if (Form2.IsDisposed)
                &#123;
                    &#x2F;&#x2F; 新建窗体
                    Form2 &#x3D; new Form2();
                &#125;
            &#125;

            &#x2F;&#x2F; 显示窗体
            Form2.Show();
            this.Left &#x3D; 0;
            &#x2F;&#x2F; 设置波形窗体紧靠主窗体
            Form2.Location &#x3D; this.Location;
            Form2.Left &#x3D; this.Right;
        &#125;
        &#x2F;&#x2F; 位置改变事件
        private void My_EXE_LocationChanged(object sender, EventArgs e)
        &#123;
            if (Form2 !&#x3D; null)
            &#123;
                &#x2F;&#x2F; 设置波形窗体紧靠主窗体
                Form2.Location &#x3D; this.Location;
                Form2.Left &#x3D; this.Right;
            &#125;
        &#125;
    &#125;
&#125;</code></pre>
              </div>
            </details>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://image-1309791158.cos.ap-guangzhou.myqcloud.com/%E5%85%B6%E4%BB%96/QQ%E6%88%AA%E5%9B%BE20230602163420.webp" alt=""></p>
<ul>
<li>绘制显示窗体与坐标，显示波形</li>
</ul>
<blockquote>
<p>基于上面代码</p>
</blockquote>
<details ><summary> Form1.cs </summary>
              <div class='content'>
              <pre class="line-numbers language-c#" data-language="c#"><code class="language-c#">&#x2F;&#x2F; 串口接收
private void serialPort1_DataReceived(object sender, SerialDataReceivedEventArgs e)
&#123;
    try
    &#123;
        byte[] data &#x3D; new byte[serialPort1.BytesToRead];
        serialPort1.Read(data, 0, data.Length);

        &#x2F;&#x2F; 遍历
        foreach (byte Number in data)
        &#123;
            string str &#x3D; Convert.ToString(Number, 16).ToUpper();
            textBox1.AppendText((str.Length &#x3D;&#x3D; 1 ? &quot;0&quot; + str : str) + &quot; &quot;);
        &#125;
        &#x2F;&#x2F; 更新波形显示窗体的链表数据
        if (Form2 !&#x3D; null)
        &#123;
            Form2.AddDataToList(data);
        &#125;
    &#125;
    catch
    &#123;
        textBox1.AppendText(&quot;[&quot; + DateTime.Now.ToString(&quot;HH:mm:ss&quot;) + &quot;]&quot; + &quot;-&gt;&quot;);
        textBox1.AppendText(&quot;HEX格式接收错误!\r\n&quot;);
    &#125;
&#125;</code></pre>
              </div>
            </details>
<details ><summary> Form2.cs </summary>
              <div class='content'>
              <pre class="line-numbers language-c#" data-language="c#"><code class="language-c#">using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Data;
using System.Drawing;
using System.Linq;
using System.Text;
using System.Windows.Forms;

namespace TEST1
&#123;
    public partial class Form2 : Form
    &#123;
        private const int StartPrint &#x3D; 40;  &#x2F;&#x2F; 点坐标偏移量
        private const int Unit_length &#x3D; 32; &#x2F;&#x2F; 单位格大小

        private int DrawStep &#x3D; 8;   &#x2F;&#x2F; 默认绘制单位
        private const int MaxStep &#x3D; 32; &#x2F;&#x2F; 绘制单位最大值
        private const int MinStep &#x3D; 1;  &#x2F;&#x2F; 绘制单位最小值

        private List&lt;byte&gt; DataList &#x3D; new List&lt;byte&gt;(); &#x2F;&#x2F;线性链表

        private Pen TablePen &#x3D; new Pen(Color.FromArgb(0x00, 0x00, 0x00));   &#x2F;&#x2F;轴线颜色
        private Pen LinesPen &#x3D; new Pen(Color.FromArgb(0xFF, 0x00, 0x00));   &#x2F;&#x2F;波形颜色

        public Form2()
        &#123;
            &#x2F;&#x2F; 波形稳定刷新---开启双缓冲
            this.SetStyle(ControlStyles.DoubleBuffer | ControlStyles.UserPaint | ControlStyles.AllPaintingInWmPaint, true);
            this.UpdateStyles();

            InitializeComponent();
        &#125;

        private void Form2_Load(object sender, EventArgs e)
        &#123;
            &#x2F;&#x2F; 重新设定波形显示窗体尺寸
            int width &#x3D; Screen.GetWorkingArea(this).Width - My_EXE.MainForm.Width;
            int Heigth &#x3D; this.Height - this.ClientRectangle.Height;
            Heigth +&#x3D; Unit_length * 16;
            Heigth +&#x3D; StartPrint * 2;
            this.Size &#x3D; new Size(width, Heigth);
        &#125;

        &#x2F;&#x2F; 链表尾部添加数据
        public void AddDataToList(byte[] Data)
        &#123;
            for (int i &#x3D; 0; i &lt; Data.Length; i++)
            &#123;
                DataList.Add(Data[i]);
            &#125;
            &#x2F;&#x2F; 刷新显示
            this.Invalidate();
        &#125;

        private void Form2_Paint(object sender, PaintEventArgs e)
        &#123;
            String Str &#x3D; &quot;&quot;;
            System.Drawing.Drawing2D.GraphicsPath gp &#x3D; new System.Drawing.Drawing2D.GraphicsPath();

            &#x2F;&#x2F; 绘画横轴线
            for (int i &#x3D; 0; i &lt; (this.ClientRectangle.Height - StartPrint) &#x2F; Unit_length; i++)
            &#123;
                &#x2F;&#x2F; 画直线---画笔，起始坐标，终点坐标
                e.Graphics.DrawLine(TablePen, StartPrint, StartPrint + i * Unit_length, this.ClientRectangle.Width, StartPrint + i * Unit_length);
                &#x2F;&#x2F; &quot;X&quot;表示转换为16进制
                Str &#x3D; ((16 - i) * 16).ToString(&quot;X&quot;);
                Str &#x3D; &quot;0x&quot; + (Str.Length &#x3D;&#x3D; 1 ? Str + &quot;0&quot; : Str);
                if (0 &#x3D;&#x3D; i)
                &#123;
                    Str &#x3D; &quot;0xFF&quot;;
                &#125;
                gp.AddString(Str, this.Font.FontFamily, (int)FontStyle.Regular, 13, new RectangleF(0, StartPrint + i * Unit_length - 8, 400, 50), null);
            &#125;
            &#x2F;&#x2F; 绘画纵轴线
            for (int i &#x3D; 0; i &lt;&#x3D; (this.ClientRectangle.Width - StartPrint) &#x2F; Unit_length; i++)
            &#123;
                e.Graphics.DrawLine(TablePen, StartPrint + i * Unit_length, StartPrint, StartPrint + i * Unit_length, StartPrint + Unit_length * 16);
                gp.AddString((i * (Unit_length &#x2F; DrawStep)).ToString(), this.Font.FontFamily, (int)FontStyle.Regular, 13, new RectangleF(StartPrint + i * Unit_length - 7, this.ClientRectangle.Height - StartPrint + 4, 400, 50), null);
            &#125;
            &#x2F;&#x2F; 绘制文字
            e.Graphics.DrawPath(Pens.Black, gp);
            &#x2F;&#x2F; 如果数据量大于可容纳的数据量，即删除最左数据
            if (DataList.Count &gt;&#x3D; (this.ClientRectangle.Width - StartPrint) &#x2F; DrawStep)
            &#123;
                DataList.RemoveRange(0, DataList.Count - (this.ClientRectangle.Width - StartPrint) &#x2F; DrawStep);
            &#125;
            for (int i &#x3D; 0; i &lt; DataList.Count - 1; i++)
            &#123;
                e.Graphics.DrawLine(LinesPen, StartPrint + i * DrawStep, StartPrint + Unit_length * 16 - DataList[i] * (Unit_length &#x2F; 16), StartPrint + (i + 1) * DrawStep, StartPrint + Unit_length * 16 - DataList[i + 1] * (Unit_length &#x2F; 16));
            &#125;
        &#125;

        private void Form2_KeyDown(object sender, KeyEventArgs e)
        &#123;
            switch (e.KeyCode)
            &#123;
                    &#x2F;&#x2F; 退出波形
                case Keys.Escape:
                    &#123;
                        this.Close();
                        break;
                    &#125;
                case Keys.PageUp:
                    &#123;
                        &#x2F;&#x2F; 放大波形
                        if (DrawStep &lt; MaxStep)
                        &#123;
                            DrawStep++;
                            this.Invalidate();
                        &#125;
                        break;
                    &#125;
                case Keys.PageDown:
                    &#123;
                        &#x2F;&#x2F; 缩小波形
                        if (DrawStep &gt; MinStep)
                        &#123;
                            DrawStep--;
                            this.Invalidate();
                        &#125;
                        break;
                    &#125;
                default: break;
            &#125;
        &#125;
    &#125;
&#125;
</code></pre>
              </div>
            </details>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://image-1309791158.cos.ap-guangzhou.myqcloud.com/%E5%85%B6%E4%BB%96/QQ%E6%88%AA%E5%9B%BE20230602211218.webp" alt=""></p>
<h2 id="其他指令">其他指令</h2>
<pre class="line-numbers language-c#" data-language="c#"><code class="language-c#">&#x2F;&#x2F; 启动多线程延时50ms
System.Threading.Thread.Sleep(50);</code></pre>
<h2 id="项目1-STC实战上位机">项目1- STC实战上位机</h2>
<blockquote>
<p>使用模板，把模板工程下的 文件夹，<code>suo</code>，<code>sln</code>  <code>csproj</code> 后缀的名称改为你自定义名称，然后双击 sln文件进入，会报错正常，然后右键移除当前项目，右键选择【添加】，添加【现有项目】，找到工程文件夹下的 <code>csproj</code> 后缀文件打开即可</p>
<p>进入工程后需要双击 <code>Properties</code>，把里面的 <code>程序集名称</code>，<code>默认命名空间</code> 也改名，然后运行报错，按照报错的行号进行替换即可</p>
<p>然后把工程文件夹 <code>bin</code>，<code>obj </code>两个文件夹删除即可会重新生成的，然后关闭工程重新打开即可</p>
</blockquote>
<details ><summary> Form1.cs </summary>
              <div class='content'>
              <pre class="line-numbers language-c#" data-language="c#"><code class="language-c#">using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Data;
using System.Drawing;
using System.Linq;
using System.Text;
using System.Windows.Forms;

&#x2F;&#x2F; 添加指令集
using System.IO.Ports;
using System.Runtime.InteropServices;


namespace STC实战上位机
&#123;
    public partial class My_EXE : Form
    &#123;
        byte Send_Num &#x3D; 0;  &#x2F;&#x2F;发送编号

        [DllImport(&quot;kernel32&quot;)]
        private static extern long WritePrivateProfileString(string section, string  key, string val, string filePath); &#x2F;&#x2F; 系统DLL导入ini写函数
        [DllImport(&quot;kernel32&quot;)]
        private static extern int GetPrivateProfileString(string section, string  key, string def, StringBuilder retVal,int size,  string filePath); &#x2F;&#x2F; 系统DLL导入ini读函数
        string FileName &#x3D; System.AppDomain.CurrentDomain.BaseDirectory + &quot;Backup.ini&quot;;  &#x2F;&#x2F; ini文件名
        StringBuilder BackupBuf &#x3D; new StringBuilder(50);    &#x2F;&#x2F; 存储读出的ini内容变量

        public My_EXE()
        &#123;
            InitializeComponent();
            &#x2F;&#x2F; 禁止这种异常的抛出(不加的话运行会报错)，避免出现跨线程访问控件
            System.Windows.Forms.Control.CheckForIllegalCrossThreadCalls &#x3D; false;
            &#x2F;&#x2F; 支持中文
            serialPort1.Encoding &#x3D; Encoding.GetEncoding(&quot;GB2312&quot;);
        &#125;
        private void flowLayoutPanel1_Paint(object sender, PaintEventArgs e)
        &#123;

        &#125;
        &#x2F;&#x2F;打开软件加载
        private void My_EXE_Load(object sender, EventArgs e)
        &#123;
            SearchAndAddSerialToComboBox(serialPort1, comboBox1);
            &#x2F;&#x2F; 恢复发送栏
            GetPrivateProfileString(&quot;串口1&quot;, &quot;发送栏&quot;, &quot;&quot;, BackupBuf, 50, FileName);
            &#x2F;&#x2F; 显示时间
            textBox4.Text &#x3D; DateTime.Now.ToString(&quot;HH:mm:ss&quot;);
        &#125;
        &#x2F;&#x2F; 手动扫描并添加可用串口
        private void SearchAndAddSerialToComboBox(SerialPort MyPort, ComboBox MyBox)
        &#123;
            MyBox.Text &#x3D; &quot; &quot;;
            &#x2F;&#x2F; 获取本机串口列表
            string[] ComputerPortName &#x3D; SerialPort.GetPortNames();
            string BackupPort;

            &#x2F;&#x2F; 恢复端口号
            GetPrivateProfileString(&quot;串口1&quot;, &quot;端口号&quot;, &quot;&quot;, BackupBuf, 50, FileName);
            BackupPort &#x3D; BackupBuf.ToString();
            &#x2F;&#x2F;清空下拉框
            MyBox.Items.Clear();
            for (byte i &#x3D; 0; i &lt; ComputerPortName.Length; i++)
            &#123;
                try
                &#123;
                    MyPort.PortName &#x3D; ComputerPortName[i];
                    MyPort.Open();
                    MyBox.Items.Add(MyPort.PortName);
                    MyPort.Close();
                    &#x2F;&#x2F; 检查端口号是否有效,端口号初始化为备份端口号
                    if (BackupPort &#x3D;&#x3D; MyPort.PortName)
                    &#123;
                        comboBox1.Text &#x3D; BackupPort;
                    &#125;
                    &#x2F;&#x2F; 备份端口无效则默认第一个
                    if (MyBox.Text &#x3D;&#x3D; &quot;&quot;)
                    &#123;
                        MyBox.Text &#x3D; MyPort.PortName;
                    &#125;
                &#125;
                catch
                &#123;

                &#125;
            &#125;
            if (MyBox.Text &#x3D;&#x3D; &quot;&quot;)
            &#123;
                textBox1.AppendText(&quot;[&quot; + DateTime.Now.ToString(&quot;HH:mm:ss&quot;) + &quot;]&quot; + &quot;-&gt;&quot;);
                textBox1.AppendText(&quot;没有检测到串口工具!\r\n&quot;);
            &#125;
            &#x2F;&#x2F; 备份端口号
            WritePrivateProfileString(&quot;串口1&quot;, &quot;端口号&quot;, MyBox.Text, FileName);
        &#125;
        &#x2F;&#x2F;【手动扫描】
        private void button1_Click(object sender, EventArgs e)
        &#123;
            &#x2F;&#x2F; 先判断串口是否打开，打开了则要关闭再扫描
            if (serialPort1.IsOpen &#x3D;&#x3D; true)
            &#123;
                serialPort1.Close();
                button2.BackgroundImage &#x3D; Properties.Resources.b1;
                button2.Tag &#x3D; &quot;OFF&quot;;
                textBox1.AppendText(&quot;[&quot; + DateTime.Now.ToString(&quot;HH:mm:ss&quot;) + &quot;]&quot; + &quot;-&gt;&quot;);
                textBox1.AppendText(&quot;扫描并添加串口时关闭串口!\r\n&quot;);
            &#125;
            SearchAndAddSerialToComboBox(serialPort1, comboBox1);
        &#125;

        private void button2_Click(object sender, EventArgs e)
        &#123;
            if (button2.Tag.ToString() &#x3D;&#x3D; &quot;OFF&quot;)
            &#123;
                &#x2F;&#x2F; 打开串口
                try
                &#123;
                    serialPort1.PortName &#x3D; comboBox1.Text;
                    &#x2F;&#x2F; 把字符串波特率转换为32位波特率
                    serialPort1.BaudRate &#x3D; Convert.ToInt32(comboBox2.Text);
                    serialPort1.Open();
                    button2.BackgroundImage &#x3D; Properties.Resources.b2;
                    button2.Tag &#x3D; &quot;ON&quot;;
                    textBox1.AppendText(&quot;[&quot; + DateTime.Now.ToString(&quot;HH:mm:ss&quot;) + &quot;]&quot; + &quot;-&gt;&quot;);
                    textBox1.AppendText(&quot;手动打开串口!\r\n&quot;);
                    &#x2F;&#x2F; 开启定时器
                    timer1.Start();
                &#125;
                catch
                &#123;
                    serialPort1.Close();
                    button2.BackgroundImage &#x3D; Properties.Resources.b1;
                    button2.Tag &#x3D; &quot;OFF&quot;;
                    textBox1.AppendText(&quot;[&quot; + DateTime.Now.ToString(&quot;HH:mm:ss&quot;) + &quot;]&quot; + &quot;-&gt;&quot;);
                    textBox1.AppendText(&quot;串口打开失败!\r\n&quot;);
                    timer1.Stop();
                &#125;
            &#125;
            else
            &#123;
                &#x2F;&#x2F; 关闭串口
                serialPort1.Close();
                button2.BackgroundImage &#x3D; Properties.Resources.b1;
                button2.Tag &#x3D; &quot;OFF&quot;;
                textBox1.AppendText(&quot;[&quot; + DateTime.Now.ToString(&quot;HH:mm:ss&quot;) + &quot;]&quot; + &quot;-&gt;&quot;);
                textBox1.AppendText(&quot;手动关闭串口!\r\n&quot;);
                timer1.Stop();
            &#125;
        &#125;
        &#x2F;&#x2F;【下拉框发生变化】
        private void comboBox1_SelectedIndexChanged(object sender, EventArgs e)
        &#123;
            if (serialPort1.IsOpen &#x3D;&#x3D; true)
            &#123;
                serialPort1.Close();
                try
                &#123;
                    serialPort1.PortName &#x3D; comboBox1.Text;
                    serialPort1.Open();
                    button2.BackgroundImage &#x3D; Properties.Resources.b2;
                    button2.Tag &#x3D; &quot;ON&quot;;
                    textBox1.AppendText(&quot;[&quot; + DateTime.Now.ToString(&quot;HH:mm:ss&quot;) + &quot;]&quot; + &quot;-&gt;&quot;);
                    textBox1.AppendText(&quot;串口更换成功!\r\n&quot;);
                &#125;
                catch
                &#123;
                    serialPort1.Close();
                    button2.BackgroundImage &#x3D; Properties.Resources.b1;
                    button2.Tag &#x3D; &quot;OFF&quot;;
                    textBox1.AppendText(&quot;[&quot; + DateTime.Now.ToString(&quot;HH:mm:ss&quot;) + &quot;]&quot; + &quot;-&gt;&quot;);
                    textBox1.AppendText(&quot;串口更换失败!\r\n&quot;);
                &#125;
            &#125;
            &#x2F;&#x2F; 备份端口号
            WritePrivateProfileString(&quot;串口1&quot;, &quot;端口号&quot;, comboBox1.Text, FileName);
        &#125;
        &#x2F;&#x2F;【定时器扫描】
        private void timer1_Tick(object sender, EventArgs e)
        &#123;
            if (!serialPort1.IsOpen)
            &#123;
                serialPort1.Close();
                button2.BackgroundImage &#x3D; Properties.Resources.b1;
                button2.Tag &#x3D; &quot;OFF&quot;;
                &#x2F;&#x2F; 重新扫描并添加串口
                SearchAndAddSerialToComboBox(serialPort1, comboBox1);
            &#125;
        &#125;
        &#x2F;&#x2F; 串口接收
        private void serialPort1_DataReceived(object sender, SerialDataReceivedEventArgs e)
        &#123;
            byte[] Data &#x3D; new byte[serialPort1.BytesToRead];    &#x2F;&#x2F; 定义缓冲区

            &#x2F;&#x2F; 检验数据是否接收完
            bool Rec_Flag &#x3D; true;
            if (Send_Num &#x3D;&#x3D; 1)  &#x2F;&#x2F; 采集命令
            &#123;
                if (Data.Length &lt; 9)
                &#123;
                    Rec_Flag &#x3D; false;
                &#125;
            &#125;
            else if (Send_Num &#x3D;&#x3D; 2)  &#x2F;&#x2F; 控制命令
            &#123;
                if (Data.Length &lt; 8)
                &#123;
                    Rec_Flag &#x3D; false;
                &#125;
            &#125;
            else
            &#123;
                serialPort1.DiscardOutBuffer(); &#x2F;&#x2F;清空缓存
                Rec_Flag &#x3D; false;
            &#125;
            &#x2F;&#x2F; 数据处理
            if (Rec_Flag)
            &#123;
                &#x2F;&#x2F; 提取数据
                try
                &#123;
                    serialPort1.Read(Data, 0, Data.Length);
                    textBox1.AppendText(&quot;[&quot; + DateTime.Now.ToString(&quot;HH:mm:ss&quot;) + &quot;]&quot; + &quot;收 &lt;-&quot;);
                    foreach (byte Number in Data)
                    &#123;
                        string str &#x3D; Convert.ToString(Number, 16).ToUpper();
                        textBox1.AppendText((str.Length &#x3D;&#x3D; 1 ? &quot;0&quot; + str : str) + &quot; &quot;);
                    &#125;
                    textBox1.AppendText(&quot;\r\n&quot;);
                    textBox1.AppendText(&quot;\r\n&quot;);
                &#125;
                catch
                &#123;
 
                &#125;
                &#x2F;&#x2F; 数据解析
                if (Data.Length &#x3D;&#x3D; 9)
                &#123;
                    UInt16 CRC &#x3D; Crc_Check(Data, 7);
                    byte CRC_H &#x3D; (byte)( CRC &gt;&gt; 8);
                    byte CRC_L &#x3D; (byte)CRC;

                    if (((Data[7] &#x3D;&#x3D; CRC_L) &amp;&amp; (Data[8] &#x3D;&#x3D; CRC_H)) || ((Data[7] &#x3D;&#x3D; CRC_H) &amp;&amp; (Data[8] &#x3D;&#x3D; CRC_L)))
                    &#123;
                        &#x2F;&#x2F; 校验地址与功能码
                        if ((Data[0] &#x3D;&#x3D; 0x01) &amp;&amp; (Data[1] &#x3D;&#x3D; 0x03))
                        &#123;
                            &#x2F;&#x2F; 校验数据长度
                            if (Data[2] &#x3D;&#x3D; 0x04)
                            &#123;
                                &#x2F;&#x2F; PCB板温度
                                float Temp_float &#x3D; (float)(Data[4] &#x2F; 2.0 - 30);
                                textBox2.Text &#x3D; Temp_float.ToString() + &quot;℃&quot;;

                                &#x2F;&#x2F; PWM灯亮度值
                                switch (Data[6])
                                &#123;
                                    case 0:
                                        &#123;
                                            textBox3.Text &#x3D; &quot;0&quot;;
                                            break;
                                        &#125;
                                    case 20:
                                        &#123;
                                            textBox3.Text &#x3D; &quot;20&quot;;
                                            break;
                                        &#125;
                                    case 40:
                                        &#123;
                                            textBox3.Text &#x3D; &quot;40&quot;;
                                            break;
                                        &#125;
                                    case 60:
                                        &#123;
                                            textBox3.Text &#x3D; &quot;60&quot;;
                                            break;
                                        &#125;
                                    case 80:
                                        &#123;
                                            textBox3.Text &#x3D; &quot;80&quot;;
                                            break;
                                        &#125;
                                    case 100:
                                        &#123;
                                            textBox3.Text &#x3D; &quot;100&quot;;
                                            break;
                                        &#125;
                                    default: break;
                                &#125;
                            &#125;
                        &#125;
                    &#125;
                    else
                    &#123;
                        textBox1.AppendText(&quot;\r\nCRC校验码错误，请检查\r\n&quot;);
                    &#125;
                &#125;
                else if (Data.Length &#x3D;&#x3D; 8)
                &#123;
                     UInt16 CRC &#x3D; Crc_Check(Data, 6);
                    byte CRC_H &#x3D; (byte)( CRC &gt;&gt; 8);
                    byte CRC_L &#x3D; (byte)CRC;

                    if (((Data[7] &#x3D;&#x3D; CRC_L) &amp;&amp; (Data[8] &#x3D;&#x3D; CRC_H)) || ((Data[7] &#x3D;&#x3D; CRC_H) &amp;&amp; (Data[8] &#x3D;&#x3D; CRC_L)))
                    &#123;
                        &#x2F;&#x2F; 校验地址与功能码
                        if ((Data[0] &#x3D;&#x3D; 0x01) &amp;&amp; (Data[1] &#x3D;&#x3D; 0x06))
                        &#123;
                            if ((Data[2] &#x3D;&#x3D; 0x94) &amp;&amp; (Data[3] &#x3D;&#x3D; 0xC2))
                            &#123;
                                &#x2F;&#x2F; PWM灯亮度值
                                switch (Data[5])
                                &#123;
                                    case 0:
                                        &#123;
                                            textBox3.Text &#x3D; &quot;0&quot;;
                                            break;
                                        &#125;
                                    case 20:
                                        &#123;
                                            textBox3.Text &#x3D; &quot;20&quot;;
                                            break;
                                        &#125;
                                    case 40:
                                        &#123;
                                            textBox3.Text &#x3D; &quot;40&quot;;
                                            break;
                                        &#125;
                                    case 60:
                                        &#123;
                                            textBox3.Text &#x3D; &quot;60&quot;;
                                            break;
                                        &#125;
                                    case 80:
                                        &#123;
                                            textBox3.Text &#x3D; &quot;80&quot;;
                                            break;
                                        &#125;
                                    case 100:
                                        &#123;
                                            textBox3.Text &#x3D; &quot;100&quot;;
                                            break;
                                        &#125;
                                    default: break;
                                &#125;
                            &#125;
                        &#125;
                    &#125;
                &#125;
            &#125;
        &#125;
        &#x2F;&#x2F; 【清屏】
        private void button3_Click(object sender, EventArgs e)
        &#123;
            textBox1.Text &#x3D; &quot;&quot;;
        &#125;
        &#x2F;&#x2F; CRC计算
        private UInt16 Crc_Check(byte[] Data, byte DataLEN)
        &#123;
            UInt16 CRC &#x3D; 0xFFFF;

            for(byte i &#x3D; 0; i &lt; DataLEN; i++)
            &#123;
                CRC ^&#x3D; Data[i];
                for(byte j &#x3D; 0;j &lt; 8; j++)
                &#123;
                    if((CRC &amp; 0x0001) &#x3D;&#x3D; 0x0001)
                    &#123;
                        CRC &#x3D; (UInt16)((CRC &gt;&gt; 1) ^ 0xA001);
                    &#125;
                    else
                    &#123;
                        CRC &#x3D; (UInt16)(CRC &gt;&gt; 1);
                    &#125;
                &#125;
            &#125;
            CRC &#x3D; (UInt16)((CRC &gt;&gt; 8) + (CRC &lt;&lt; 8));
            return CRC;
        &#125;

        private void comboBox2_SelectedIndexChanged(object sender, EventArgs e)
        &#123;
            serialPort1.BaudRate &#x3D; Convert.ToInt32(comboBox2.Text);
        &#125;

        private void label4_Click(object sender, EventArgs e)
        &#123;

        &#125;
        &#x2F;&#x2F; 采集数据
        private void timer2_Tick(object sender, EventArgs e)
        &#123;
            if (serialPort1.IsOpen)
            &#123;
                try
                &#123;
                    byte[] Data &#x3D; new byte[8] &#123;0x01, 0x03, 0x9C, 0x41, 0x00, 0x02, 0x00, 0x00&#125;;
                    &#x2F;&#x2F;插入CRC
                    UInt16 CRC &#x3D; Crc_Check(Data, 6);
                    byte CRC_H &#x3D; (byte)(CRC &gt;&gt; 8);
                    byte CRC_L &#x3D; (byte)CRC;
                    Data[6] &#x3D; CRC_L;
                    Data[7] &#x3D; CRC_H;
                    &#x2F;&#x2F; 发送
                    serialPort1.Write(Data, 0, 8);
                    textBox1.AppendText(&quot;[&quot; + DateTime.Now.ToString(&quot;HH:mm:ss&quot;) + &quot;]&quot; + &quot;发 -&gt;&quot;);
                    foreach (byte Number in Data)
                    &#123;
                        string str &#x3D; Convert.ToString(Number, 16).ToUpper();
                        textBox1.AppendText((str.Length &#x3D;&#x3D; 1 ? &quot;0&quot; + str : str) + &quot; &quot;);
                    &#125;
                    textBox1.AppendText(&quot;\r\n&quot;);
                    Send_Num &#x3D; 1;
                &#125;
                catch
                &#123;
                    serialPort1.Close();
                    button2.BackgroundImage &#x3D; Properties.Resources.b1;
                    button2.Tag &#x3D; &quot;OFF&quot;;
                    textBox1.AppendText(&quot;[&quot; + DateTime.Now.ToString(&quot;HH:mm:ss&quot;) + &quot;]&quot; + &quot;-&gt;&quot;);
                    textBox1.AppendText(&quot;采集命令发送失败\r\n&quot;);
                    timer1.Stop();  &#x2F;&#x2F;关闭串口工具异常检测
                &#125;
            &#125;
            
        &#125;

        private void button4_Click(object sender, EventArgs e)
        &#123;
            if (serialPort1.IsOpen)
            &#123;
                try
                &#123;
                    byte[] Data &#x3D; new byte[8] &#123; 0x01, 0x06, 0x9C, 0x42, 0x00, 0x00, 0x00, 0x00 &#125;;
                    &#x2F;&#x2F; 获取PWM灯亮度值
                    switch (comboBox3.Text.Length)
                    &#123;
                        case 2:
                            &#123;
                                &#x2F;&#x2F; 0%则把%去掉
                                Data[5] &#x3D; Convert.ToByte(comboBox3.Text.Substring(0, 1), 10);
                                break;
                            &#125;
                        case 3:
                            &#123;
                                &#x2F;&#x2F; 10%则把%去掉
                                Data[5] &#x3D; Convert.ToByte(comboBox3.Text.Substring(0, 2), 10);
                                break;
                            &#125;
                        case 4:
                            &#123;
                                &#x2F;&#x2F; 100%则把%去掉
                                Data[5] &#x3D; Convert.ToByte(comboBox3.Text.Substring(0, 3), 10);
                                break;
                            &#125;
                        default: break;
                    &#125;
                    &#x2F;&#x2F;插入CRC
                    UInt16 CRC &#x3D; Crc_Check(Data, 6);
                    byte CRC_H &#x3D; (byte)(CRC &gt;&gt; 8);
                    byte CRC_L &#x3D; (byte)CRC;
                    Data[6] &#x3D; CRC_L;
                    Data[7] &#x3D; CRC_H;
                    &#x2F;&#x2F; 发送
                    serialPort1.Write(Data, 0, 8);
                    textBox1.AppendText(&quot;[&quot; + DateTime.Now.ToString(&quot;HH:mm:ss&quot;) + &quot;]&quot; + &quot;发 -&gt;&quot;);
                    foreach (byte Number in Data)
                    &#123;
                        string str &#x3D; Convert.ToString(Number, 16).ToUpper();
                        textBox1.AppendText((str.Length &#x3D;&#x3D; 1 ? &quot;0&quot; + str : str) + &quot; &quot;);
                    &#125;
                    textBox1.AppendText(&quot;\r\n&quot;);
                    &#x2F;&#x2F; 重新启动timer2,错开采集与控制指令
                    timer2.Stop();
                    timer2.Start();
                    Send_Num &#x3D; 2;
                &#125;
                catch
                &#123;
                    serialPort1.Close();
                    button2.BackgroundImage &#x3D; Properties.Resources.b1;
                    button2.Tag &#x3D; &quot;OFF&quot;;
                    textBox1.AppendText(&quot;[&quot; + DateTime.Now.ToString(&quot;HH:mm:ss&quot;) + &quot;]&quot; + &quot;-&gt;&quot;);
                    textBox1.AppendText(&quot;控制命令发送失败\r\n&quot;);
                    timer1.Stop();  &#x2F;&#x2F;关闭串口工具异常检测
                &#125;
            &#125;
        &#125;

        private void comboBox3_SelectedIndexChanged(object sender, EventArgs e)
        &#123;

        &#125;

        private void textBox5_TextChanged(object sender, EventArgs e)
        &#123;

        &#125;

        private void button5_Click(object sender, EventArgs e)
        &#123;
            if (textBox5.Text &#x3D;&#x3D; &quot;&quot;)
            &#123;
                MessageBox.Show(&quot;不能为空&quot;, &quot;提示&quot;);
                return;
            &#125;
            if (button5.Tag.ToString() &#x3D;&#x3D; &quot;1&quot;)
            &#123;
                int i &#x3D; 0;
                &#x2F;&#x2F; 处理字符串
                string Buf &#x3D; textBox5.Text;
                &#x2F;&#x2F; 去掉0x 0X
                Buf &#x3D; Buf.Replace(&quot;0x&quot;, string.Empty);
                Buf &#x3D; Buf.Replace(&quot;0X&quot;, string.Empty);
                Buf &#x3D; Buf.Replace(&quot; &quot;, string.Empty);
                byte[] data &#x3D; new byte[((Buf.Length - Buf.Length % 2) &#x2F; 2) + 2];
                &#x2F;&#x2F;循环发送，保证都是2位，1位就丢弃
                for (i &#x3D; 0; i &lt; (Buf.Length - Buf.Length % 2) &#x2F; 2; i++)
                &#123;
                    try
                    &#123;
                        &#x2F;&#x2F; 转换为16进制
                        data[i] &#x3D; Convert.ToByte(Buf.Substring(i * 2, 2), 16);
                    &#125;
                    catch
                    &#123;
                        MessageBox.Show(&quot;非十六进制！！&quot;, &quot;警告&quot;);
                        textBox5.Text &#x3D; &quot;&quot;;
                        return;
                    &#125;
                &#125;
                UInt16 CRC &#x3D; Crc_Check(data, (byte)i);
                byte CRC_H &#x3D; (byte)(CRC &gt;&gt; 8);
                byte CRC_L &#x3D; (byte)CRC;
                &#x2F;&#x2F; 默认低位在前高位在后
                data[i] &#x3D; CRC_L;
                data[i + 1] &#x3D; CRC_H;
                textBox5.Text &#x3D; &quot;&quot;;
                textBox5.ForeColor &#x3D; Color.Red;
                foreach (byte Number in data)
                &#123;
                    string str &#x3D; Convert.ToString(Number, 16).ToUpper();
                    textBox5.AppendText((str.Length &#x3D;&#x3D; 1 ? &quot;0&quot; + str : str) + &quot; &quot;);
                &#125;
                button5.Tag &#x3D; &quot;2&quot;;
                button5.Text &#x3D; &quot;清除&quot;;
            &#125;
            else
            &#123;
                textBox5.Text &#x3D; &quot;&quot;;
                button5.Text &#x3D; &quot;计算&quot;;
                textBox5.ForeColor &#x3D; Color.Black;
                button5.Tag &#x3D; &quot;1&quot;;
            &#125;
        &#125;

        private void timer3_Tick(object sender, EventArgs e)
        &#123;
            textBox4.Text &#x3D; DateTime.Now.ToString(&quot;HH:mm:ss&quot;);
        &#125;
    &#125;
&#125;
</code></pre>
              </div>
            </details>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://image-1309791158.cos.ap-guangzhou.myqcloud.com/%E5%85%B6%E4%BB%96/QQ%E6%88%AA%E5%9B%BE20230603134023.webp" alt=""></p>
</article><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="social-share" data-image="/img/num132.webp" data-sites="wechat,qq"></div><link rel="stylesheet" href="https://lib.baomitu.com/social-share.js/1.0.16/css/share.min.css" media="print" onload="this.media='all'"><script src="https://lib.baomitu.com/social-share.js/1.0.16/js/social-share.min.js" defer></script></div></div></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BD%AF%E4%BB%B6%E5%AE%89%E8%A3%85"><span class="toc-number">2.</span> <span class="toc-text">软件安装</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B7%A5%E7%A8%8B%E7%AE%A1%E7%90%86%E5%99%A8"><span class="toc-number">3.</span> <span class="toc-text">工程管理器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC2%E8%AE%B2"><span class="toc-number">4.</span> <span class="toc-text">第2讲</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC3%E8%AE%B2"><span class="toc-number">5.</span> <span class="toc-text">第3讲</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC4%E8%AE%B2"><span class="toc-number">6.</span> <span class="toc-text">第4讲</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC5%E8%AE%B2"><span class="toc-number">7.</span> <span class="toc-text">第5讲</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC6%E8%AE%B2"><span class="toc-number">8.</span> <span class="toc-text">第6讲</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC7%E8%AE%B2"><span class="toc-number">9.</span> <span class="toc-text">第7讲</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC8%E8%AE%B2"><span class="toc-number">10.</span> <span class="toc-text">第8讲</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B6%E4%BB%96%E6%8C%87%E4%BB%A4"><span class="toc-number">11.</span> <span class="toc-text">其他指令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE1-STC%E5%AE%9E%E6%88%98%E4%B8%8A%E4%BD%8D%E6%9C%BA"><span class="toc-number">12.</span> <span class="toc-text">项目1- STC实战上位机</span></a></li></ol></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2022 - 2023  <i id="heartbeat" class="fa fas fa-heartbeat"></i> Luckys-Yang</div><div class="footer_custom_text"><div class="github-badge"><a href="http://beian.miit.gov.cn/" target="_blank" title="粤ICP备 2022026282号-1" ), pointer;"><span class="badge-subject">粤ICP备</span><span class="badge-value bg-green">2022026282号-1</span></a></div><div class="github-badge"><a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=44070502000559" title="44070502000559号"><span class="badge-subject"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bed.attainment.cn/img/40.png" style="float:left;" />粤公网安备</span><span class="badge-value bg-green">44070502000559号</span></a></div><div><a style="margin-inline:5px" target="_blank" href="https://hexo.io/"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://image-1309791158.cos.ap-guangzhou.myqcloud.com/butterfly/blog_other/Frame-Hexo-blue.svg" title="博客框架为 Hexo" alt="HEXO"></a><a style="margin-inline:5px" target="_blank" href="https://butterfly.js.org/"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://image-1309791158.cos.ap-guangzhou.myqcloud.com/butterfly/blog_other/Theme-Butterfly-6513df.svg" title="主题采用 Butterfly" alt="Butterfly"></a><a style="margin-inline:5px" target="_blank" href="https://vercel.com/"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://image-1309791158.cos.ap-guangzhou.myqcloud.com/其他/Hosted-Vercel-brightgreen.svg" title="本站采用多线部署，次线路托管于Vercel" alt="HEXO"></a></div></div><div id="running-time" style="color: #5c5c5c;"><script>setInterval(()=>{let create_time=Math.round(new Date('3/10/2022 08:00:00').getTime()/1000);let timestamp=Math.round((new Date().getTime()+8*60*60*1000)/1000);let second=timestamp-create_time;let time=new Array(0,0,0,0,0);if(second>=365*24*3600){time[0]=parseInt(second/(365*24*3600));second%=365*24*3600;}if(second>=24*3600){time[1]=parseInt(second/(24*3600));second%=24*3600;}if(second>=3600){time[2]=parseInt(second/3600);second%=3600;}if(second>=60){time[3]=parseInt(second/60);second%=60;}if(second>0){time[4]=second;}currentTimeHtml='本站已苟活了 '+time[0]+' 年 '+time[1]+' 天 '+time[2]+' 时 '+time[3]+' 分 '+time[4]+' 秒';document.getElementById("running-time").innerHTML=currentTimeHtml;},1000);</script></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="translateLink" type="button" title="简繁转换">繁</button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button><button id="go-down" type="button" title="直达底部" onclick="btf.scrollToDest(document.body.scrollHeight, 500)"><i class="fas fa-arrow-down"></i></button></div></div><div id="nav-music"><div id="nav-music-hoverTips" onclick="anzhiyu.musicToggle()">播放音乐</div><meting-js id="8183137343" server="netease" type="playlist" mutex="true" preload="none" theme="var(--anzhiyu-main)" data-lrctype="0" order="random"></meting-js></div><div id="algolia-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="search-wrap"><div id="algolia-search-input"></div><hr/><div id="algolia-search-results"><div id="algolia-hits"></div><div id="algolia-pagination"></div><div id="algolia-info"><div class="algolia-stats"></div><div class="algolia-poweredBy"></div></div></div></div></div><div id="search-mask"></div></div><div class="js-pjax" id="rightMenu"><div class="rightMenu-group rightMenu-small"><a class="rightMenu-item" href="javascript:window.history.back();"><i class="fa fa-arrow-left"></i></a><a class="rightMenu-item" href="javascript:window.history.forward();"><i class="fa fa-arrow-right"></i></a><a class="rightMenu-item" href="javascript:window.location.reload();"><i class="fa fa-refresh"></i></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-text"><a class="rightMenu-item" href="javascript:rmf.copySelect();"><i class="fa fa-copy"></i><span>复制</span></a><a class="rightMenu-item" href="javascript:window.open(&quot;https://www.baidu.com/s?wd=&quot;+window.getSelection().toString());window.location.reload();"><i class="fa fa-paw"></i><span>百度搜索</span></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-too"><a class="rightMenu-item" href="javascript:window.open(window.getSelection().toString());window.location.reload();"><i class="fa fa-link"></i><span>转到链接</span></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-paste"></div><div class="rightMenu-group rightMenu-line hide" id="menu-post"><a class="rightMenu-item" href="javascript:rmf.copyWordsLink()"><i class="fa fa-link"></i><span>复制本文地址</span></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-to"><a class="rightMenu-item" href="javascript:rmf.openWithNewTab()"><i class="fa fa-window-restore"></i><span>新窗口打开</span></a><a class="rightMenu-item" id="menu-too" href="javascript:rmf.open()"><i class="fa fa-link"></i><span>转到链接</span></a><a class="rightMenu-item" href="javascript:rmf.copyLink()"><i class="fa fa-copy"></i><span>复制链接</span></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-img"><a class="rightMenu-item" href="javascript:rmf.saveAs()"><i class="fa fa-download"></i><span>保存图片</span></a><a class="rightMenu-item" href="javascript:rmf.openWithNewTab()"><i class="fa fa-window-restore"></i><span>在新窗口打开</span></a><a class="rightMenu-item" href="javascript:rmf.copyLink()"><i class="fa fa-copy"></i><span>复制图片链接</span></a></div><div class="rightMenu-group rightMenu-line"><a class="rightMenu-item" href="https://yang5201314.cn/"><i class="fa fa-home"></i><span>主页</span></a><a class="rightMenu-item" href="/categories/"><i class="fa-solid fa-folder-open"></i><span>文章分类</span></a><a class="rightMenu-item" href="/tags/"><i class="fa-solid fa-tags"></i><span>文章标签</span></a><a class="rightMenu-item" href="/archives/"><i class="fa-solid fa-folder-open"></i><span>文章归档</span></a><a class="rightMenu-item" href="https://www.foreverblog.cn/go.html" target="_blank"><i class="fa fa-certificate"></i><span>虫洞</span></a><a class="rightMenu-item" href="javascript:rmf.fullScreen();"><i class="fas fa-expand"></i><span>切换全屏</span></a></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script defer src="/js/tw_cn.js"></script><script defer src="https://cdn.staticfile.org/fancyapps-ui/4.0.27/fancybox.umd.min.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/instant.page/5.1.0/instantpage.min.js" type="module" defer></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/vanilla-lazyload/17.3.1/lazyload.iife.min.js"></script><script defer src="https://jsd.onmicrosoft.cn/npm/algoliasearch/dist/algoliasearch-lite.umd.min.js"></script><script defer src="https://jsd.onmicrosoft.cn/npm/instantsearch.js/dist/instantsearch.production.min.js"></script><script defer src="/js/search/algolia.js"></script><div class="js-pjax"></div><script src="https://jsd.onmicrosoft.cn/npm/prismjs/prism.min.js"></script><script src="https://jsd.onmicrosoft.cn/npm/prismjs/plugins/autoloader/prism-autoloader.min.js"></script><script src="https://jsd.onmicrosoft.cn/npm/prismjs/plugins/line-numbers/prism-line-numbers.min.js"></script><canvas id="universe"></canvas><script defer src="/js/universe.js"></script><script async type="text/javascript" src="https://jsd.onmicrosoft.cn/npm/izitoast@1.4.0/dist/js/iziToast.min.js"></script><script>
    document.body.oncopy = function () {
        iziToast.info({
            timeout: 4000, // 关闭弹窗的时间
          // icon: 'Fontawesome', // 图标类别
            closeOnEscape: 'true', // 允许使用Esc键关闭弹窗
            transitionIn: 'bounceInLeft', // 弹窗打开动画
            transitionOut: 'fadeOutRight', // 弹窗关闭动画
            displayMode: 'replace', // 替换已经打开的弹窗
            layout: '2', // Medium模式
            position: 'topRight', // 弹窗位置
            //icon: 'fad fa-copy', // 图标类名
            iconUrl:'https://image-1309791158.cos.ap-guangzhou.myqcloud.com/其他/1122star.svg',
            backgroundColor: 'rgb(179, 182, 180)', // 弹窗背景色
            title: '复制成功', // 通知标题
            message: '键盘敲烂 月薪过万' // 通知消息内容
        });
    }
</script>
<script defer type="text/javascript" src="/js/rightmenu.js"></script><script  type="text/javascript" src="https://cdn.staticfile.org/jquery/3.6.3/jquery.min.js"></script><script defer type="text/javascript" src="/js/IPdw.js"></script><script async src="//npm.elemecdn.com/pace-js@1.2.4/pace.min.js"></script><script defer data-pjax src="/js/newYear.js"></script><script defer src="/js/my_aplayer.js"></script><script defer src="/js/meting.js"></script><script id="click-heart" src="https://jsd.onmicrosoft.cn/npm/butterfly-extsrc/dist/click-heart.min.js" async="async" mobile="false"></script><link rel="stylesheet" href="https://lf6-cdn-tos.bytecdntp.com/cdn/expire-1-M/aplayer/1.10.1/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://lf6-cdn-tos.bytecdntp.com/cdn/expire-1-M/aplayer/1.10.1/APlayer.min.js"></script><script src="https://jsd.onmicrosoft.cn/npm/butterfly-extsrc/metingjs/dist/Meting.min.js"></script><script src="https://cdn.staticfile.org/pjax/0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["link[rel=\"canonical\"]","meta[property=\"og:image\"]","meta[property=\"og:title\"]","meta[property=\"og:url\"]","head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener scroll 
  window.tocScrollFn && window.removeEventListener('scroll', window.tocScrollFn)
  window.scrollCollect && window.removeEventListener('scroll', scrollCollect)

  document.getElementById('rightside').style.cssText = "opacity: ''; transform: ''"
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

  typeof disqusjs === 'object' && disqusjs.destroy()
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof chatBtnFn === 'function' && chatBtnFn()
  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', (e) => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script></div><!-- hexo injector body_end start --><div class="js-pjax"><script async="async">var arr = document.getElementsByClassName('recent-post-item');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__zoomIn');
    arr[i].setAttribute('data-wow-duration', '1s');
    arr[i].setAttribute('data-wow-delay', '250ms');
    arr[i].setAttribute('data-wow-offset', '100');
    arr[i].setAttribute('data-wow-iteration', '1');
  }</script><script async="async">var arr = document.getElementsByClassName('card-widget');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__zoomIn');
    arr[i].setAttribute('data-wow-duration', '');
    arr[i].setAttribute('data-wow-delay', '');
    arr[i].setAttribute('data-wow-offset', '');
    arr[i].setAttribute('data-wow-iteration', '');
  }</script></div><script defer src="https://npm.elemecdn.com/hexo-butterfly-wowjs/lib/wow.min.js"></script><script defer src="https://npm.elemecdn.com/hexo-butterfly-wowjs/lib/wow_init.js"></script><!-- hexo injector body_end end --></body></html>